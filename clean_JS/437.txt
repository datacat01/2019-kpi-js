//<!--
/* <![CDATA[ (head-active_data.js) */
var dw = (window.dw || {});
dw.ac = {
    _analytics: null,
    _events: [],
    _category: "",
    _capture: function(configs) {
        if (Object.prototype.toString.call(configs) === "[object Array]") {
            configs.forEach(captureObject);
            return;
        }
        dw.ac._events.push(configs);
    },
	capture: function() { 
		dw.ac._capture(arguments);
		// send to CQ as well:
		if (window.CQuotient) {
			window.CQuotient.trackEventsFromAC(arguments);
		}
	},
    EV_PRD_SEARCHHIT: "searchhit",
    EV_PRD_DETAIL: "detail",
    EV_PRD_RECOMMENDATION: "recommendation",
    EV_PRD_SETPRODUCT: "setproduct",
    applyContext: function(context) {
        if (typeof context === "object" && context.hasOwnProperty("category")) {
        	dw.ac._category = context.category;
        }
    },
    setDWAnalytics: function(analytics) {
        dw.ac._analytics = analytics;
    }
};
/* ]]> */
// -->

//<!--
/* <![CDATA[ (head-cquotient.js) */
var CQuotient = window.CQuotient = {};
CQuotient.clientId = 'aalc-dartagnan';
CQuotient.activities = [];
CQuotient.cqcid='';
CQuotient.cquid='';
CQuotient.initFromCookies = function () {
	var ca = document.cookie.split(';');
	for(var i=0;i < ca.length;i++) {
	  var c = ca[i];
	  while (c.charAt(0)==' ') c = c.substring(1,c.length);
	  if (c.indexOf('cqcid=') == 0) {
		  CQuotient.cqcid=c.substring('cqcid='.length,c.length);
	  } else if (c.indexOf('cquid=') == 0) {
		  CQuotient.cquid=c.substring('cquid='.length,c.length);
		  break;
	  }
	}
}
CQuotient.getCQCookieId = function () {
	if(window.CQuotient.cqcid == '')
		window.CQuotient.initFromCookies();
	return window.CQuotient.cqcid;
};
CQuotient.getCQUserId = function () {
	if(window.CQuotient.cquid == '')
		window.CQuotient.initFromCookies();
	return window.CQuotient.cquid;
};
CQuotient.trackEventsFromAC = function (/* Object or Array */ events) {
try {
	if (Object.prototype.toString.call(events) === "[object Array]") {
		events.forEach(_trackASingleCQEvent);
	} else {
		CQuotient._trackASingleCQEvent(events);
	}
} catch(err) {}
};
CQuotient._trackASingleCQEvent = function ( /* Object */ event) {
	if (event && event.id) {
		if (event.type === dw.ac.EV_PRD_DETAIL) {
			CQuotient.trackViewProduct( {id:'', alt_id: event.id, type: 'raw_sku'} );
		} // not handling the other dw.ac.* events currently
	}
};
CQuotient.trackViewProduct = function(/* Object */ productData){
	var cq_params = {};
	cq_params.cookieId = CQuotient.getCQCookieId();
	cq_params.userId = CQuotient.getCQUserId();
	cq_params.product = productData;
	if(CQuotient.sendActivity) {
		CQuotient.sendActivity(CQuotient.clientId, 'viewProduct', cq_params);
	} else {
		CQuotient.activities.push({activityType: 'viewProduct', parameters: cq_params});
	}
};
/* ]]> */
// -->


		var device;
		var sUsrAg = navigator.userAgent.toLowerCase();
		
		if(sUsrAg.match(/iphone|ipod|opera mini|palm|blackberry|iemobile|phone/i)) {
			device = "m";
		} else if ( sUsrAg.match(/android/i) && window.innerWidth <= 767){
			device = "m";
		} else if (sUsrAg.match(/ipad|tablet/i)) {
			device = "t";
		} else if ( sUsrAg.match(/android/i) && window.innerWidth > 768){
			device = "t";
		} else {
			device = "d";
		}
		
		window.criteo_q = window.criteo_q || [];
		window.criteo_q.push(
		{ event: "setAccount", account: 7078 },
		{ event: "setCustomerId", id: "acXigkv0OkWvHDmQcKaL8x5u2H"}, 
		{ event: "setSiteType", type: device},
		{ event: "viewHome"}
		); 
	

	var biJsHost = (("https:" == document.location.protocol) ? "https://" : "http://");
	document.write(unescape("%3Cscript src='" + biJsHost + "cdn.listrakbi.com/scripts/script.js?m=M1cg0llUhuyU&v=1' type='text/javascript'%3E%3C/script%3E"));
	

	
	try {
		
		/* Capture the click from a message. */
		_ltk.Click.Submit();
	}
	catch (er)
	{
		/* An error has occurred, yet to determine if we want to do anything here. */
	}


		if (typeof _ltk != "undefined") {
			var _ltkwmt = '';
			
				_ltkwmt = 'Email Address';
			
			
			  
				_ltk.SCA.CaptureEmail("dwfrm_profile_customer_email");
			  
				_ltk.SCA.CaptureEmail("dwfrm_login_username");
			  
				_ltk.SCA.CaptureEmail("dwfrm_billing_billingAddress_email_emailAddress");
			  
				_ltk.SCA.CaptureEmail("email");
			  
			
		}
	


	/* Used to reset the activity tracker parameters in the pdict upon successful send up to Listrak endpoint. */
	function resetProductActivityParams()
	{
		var path = '/on/demandware.store/Sites-dartagnan-Site/default/ltkActivityTrackerClearItems-ClearFlag';
		jQuery.ajax({
			  url: path,
			  context: document,
			  success: function(){ }
		});
	}	
	
	try {
		/* Perform activity/page/product browse logging. */
		var sessionSku = 'null';
		var sessionCategory = 'null';
		var sessionQuickViewSkus = 'null';		
		
		/* Iterate through any quickviews and add them as product browses. */
		if (sessionQuickViewSkus != null && sessionQuickViewSkus != "null" && sessionQuickViewSkus.length > 0)
		{
			var quickViews = sessionQuickViewSkus.split(',');
			
			for (var i = 0; i < quickViews.length; i++)
			{
				_ltk.Activity.AddProductBrowse(quickViews[i]);			
			}
		}
		
		/* Add the product browse if we have it. */
		if (sessionSku != null && sessionSku != "null" && sessionSku.length > 0)
		{
			_ltk.Activity.AddProductBrowse(sessionSku);
		}			
		
		/* Add the page browse. We should ALWAYS have if this JS fires. */
		var currentPage = window.location.href;
		_ltk.Activity.AddPageBrowse(currentPage);
		
		/* Submit the activity through client side JS to the endpoint. */
		_ltk.Activity.Submit();
		
		/* Do a post to reset the browse/quickview/page parameters if there are products in them. */
		resetProductActivityParams();
	}
	catch (er)
	{
		/* An error has occurred, yet to determine if we want to do anything here. */
	}


 
			var _qevents = _qevents || [];
			
			(function() {
			var elem = document.createElement('script');
			elem.src = (document.location.protocol == "https:" ? "https://secure" : "http://edge") + ".quantserve.com/quant.js";
			elem.async = true;
			elem.type = "text/javascript";
			var scpt = document.getElementsByTagName('script')[0];
			scpt.parentNode.insertBefore(elem, scpt);
			})();
			
			_qevents.push(
			{qacct:"p-05eUqVvScf4eA",labels:"_fp.event.Home Page"}
			);
		
//<!--
/* <![CDATA[ */
function trackPage() {
    try{
        var trackingUrl = "https://www.dartagnan.com/on/demandware.store/Sites-dartagnan-Site/default/__Analytics-Start";
        var dwAnalytics = dw.__dwAnalytics.getTracker(trackingUrl);
        if (typeof dw.ac == "undefined") {
            dwAnalytics.trackPageView();
        } else {
            dw.ac.setDWAnalytics(dwAnalytics);
        }
    }catch(err) {};
}
/* ]]> */
// -->

