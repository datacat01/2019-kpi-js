(window.webpackJsonp=window.webpackJsonp||[]).push([["CollectionCommentsPage~CommentsPage~Explore~Frontpage~GovernanceReleaseNotesModal~ModListing~ModQueu~1084d5fc"],{"./src/reddit/components/Media/RichTextContainer/index.m.less":function(e,t,i){e.exports={richTextContainer:"Chtkt3BCZQruf0LtmFg2c",richTextContainerFull:"_3xX726aBn29LDbsDtzr_6E",placeholder:"_1aLU7RPNLdvfcbaNdcN11x",placeholderParagraph:"Owi9iYzjyVpDq_0YbCdJY"}},"./src/reddit/components/Media/index.m.less":function(e,t,i){e.exports={hiddenLink:"_3dhFVFchWAAFXfLFTa94n9",displayNone:"_1Q2mF3u7v9hBVu_4bkC7R4"}},"./src/reddit/components/Media/index.tsx":function(e,t,i){"use strict";var n,o=i("./node_modules/babel-runtime/helpers/extends.js"),s=i.n(o),a=i("./node_modules/babel-runtime/helpers/slicedToArray.js"),d=i.n(a),r=i("./node_modules/babel-runtime/helpers/classCallCheck.js"),c=i.n(r),l=i("./node_modules/babel-runtime/helpers/createClass.js"),u=i.n(l),h=i("./node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),p=i.n(h),m=i("./node_modules/babel-runtime/helpers/inherits.js"),f=i.n(m),v=i("./node_modules/babel-runtime/helpers/jsx.js"),b=i.n(v),g=i("./node_modules/lodash/debounce.js"),x=i.n(g),w=i("./node_modules/react/index.js"),y=i.n(w),E=i("./bundled-modules/styled-components/styled-components.min.js"),C=i.n(E),M=i("./src/lib/isUrl/index.ts"),I=i("./node_modules/brcast/dist/brcast.es.js"),S=i("./node_modules/lodash/findKey.js"),L=i.n(S);!function(e){e.Hidden="hidden",e.Visible="visible"}(n||(n={}));var O={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"},T=!1,P=Object(I.a)({documentInFocus:!0});!function(){if(!T){var e=L()(O,function(e,t){return void 0!==document[t]});e&&document.addEventListener(O[e],function(){P.setState({documentInFocus:document.visibilityState!==n.Hidden})}),T=!0}}();var j=function(e){return P.subscribe(e)},F=function(e){P.unsubscribe(e)},W=i("./src/lib/permalinkToOverlayLocation/index.ts"),D=i("./src/lib/raven/index.ts"),R=i("./src/reddit/components/HTML5StreamPlayer/index.tsx"),V=i("./src/reddit/components/Media/EmbedBox/index.tsx"),k=i("./src/reddit/components/Media/ImageBox/index.tsx"),N=i("./src/reddit/components/Media/MediaContainer/index.tsx"),_=i("./src/lib/classNames/index.ts"),B=i("./src/reddit/constants/componentSizes.ts"),H=i("./src/reddit/models/Media/index.ts"),A=i("./node_modules/react-redux/es/index.js"),U=i("./src/reddit/actions/post.ts"),G=i("./src/reddit/helpers/styles/mixins/loading.ts"),z=i("./src/reddit/components/Media/RichTextContainer/index.m.less"),J=i.n(z),q=C.a.div.withConfig({componentId:"s123n0am-0"})(["",""],G.b),X=Object(A.connect)(null,function(e){return{onLoadRichTextContentIfNeeded:function(t){return e(Object(U.p)(t))}}})(function(e){function t(){return c()(this,t),p()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f()(t,e),u()(t,[{key:"componentDidMount",value:function(){this.loadRichTextContentIfNeeded()}},{key:"loadRichTextContentIfNeeded",value:function(){this.props.canLoadContent&&this.props.isExpando&&this.props.onLoadRichTextContentIfNeeded(this.props.postId)}},{key:"render",value:function(){return b()("div",{className:J.a.placeholder},void 0,[1,2,3].map(function(e){return b()("div",{className:J.a.placeholderParagraph},e,b()(q,{isLoading:!0,gradientType:"posts"}),b()(q,{isLoading:!0,gradientType:"posts"}),b()(q,{isLoading:!0,gradientType:"posts"}))}))}}]),t}(y.a.Component)),Y=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&(i[n[o]]=e[n[o]])}return i},Q=function(e){var t=e.canLoadContent,i=e.children,n=e.className,o=e.isCommentsPage,a=e.isRichTextTruncated,d=e.isExpando,r=e.postId,c=e.showFull,l=Y(e,["canLoadContent","children","className","isCommentsPage","isRichTextTruncated","isExpando","postId","showFull"]),u=c?J.a.richTextContainerFull:J.a.richTextContainer,h={};c||(h.maxHeight=H.j+"px"),o&&(h.maxWidth=B.g+"px");var p=a&&c;return y.a.createElement("div",s()({className:Object(_.a)(u,n),style:h},l),i,p&&b()(X,{canLoadContent:!!t,isExpando:d,postId:r}))},K=i("./src/reddit/components/Media/VideoBox/index.tsx"),Z=i("./src/reddit/components/PlayButton/index.tsx"),$=i("./src/reddit/components/RawHTMLDisplay/index.tsx"),ee=i("./src/reddit/components/RichTextJson/index.tsx"),te=i("./src/reddit/constants/screenWidths.ts"),ie=i("./src/reddit/helpers/canPreviewSelfText/index.ts"),ne=i("./src/reddit/helpers/getRichTextContent.ts"),oe=i("./src/reddit/helpers/postHasSelfText/index.ts"),se=i("./src/lib/redditId/index.ts");function ae(e,t){var i=function e(t,i){var n=!1;var o=[];try{var s=!0,a=!1,d=void 0;try{for(var r,c=t[Symbol.iterator]();!(s=(r=c.next()).done);s=!0){var l=r.value;if("link"===l.e&&l.u&&l.u.includes("https://www.reddit.com/poll/"+i))n=!0;else if(l.c&&"string"!=typeof l.c){var u=e(l.c,i);u.found?(n=!0,("par"!==l.e||u.updated.length)&&o.push(Object.assign({},l,{c:u.updated}))):o.push(l)}else o.push(l)}}catch(e){a=!0,d=e}finally{try{!s&&c.return&&c.return()}finally{if(a)throw d}}}catch(e){n=!1,o=[]}return{found:n,updated:n?o:t}}(e.document,Object(se.c)(t));return i.found?{document:i.updated}:e}var de=i("./src/reddit/components/Media/index.m.less"),re=i.n(de),ce="https://www.redditmedia.com",le="player.js",ue=B.F+B.E,he=function(e){return e.isVisible?e.children:b()("div",{className:re.a.displayNone},void 0,e.children)},pe=new Set([H.m.EMBED,H.m.GIFVIDEO,H.m.VIDEO]),me=new Set([H.m.EMBED,H.m.GIFVIDEO,H.m.IMAGE,H.m.VIDEO]),fe=function(e){return!!e.media&&me.has(e.media.type)},ve=function(e){function t(e){c()(this,t);var i=p()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.pauseContent=function(){i.shouldFocusContentDebouncer(!1)},i.stopContent=function(){var e=i.props.post.media;if(e&&H.d.has(e.type)){if(i.iframe){var t=e.type===H.m.EMBED?e.provider:null;i.pauseEmbed(i.iframe,t)}i.setState(function(e){return e.shouldStop?null:{shouldStop:!0}})}},i.handleVisibilityChange=function(e){var t=i.state.shouldPause,n=i.props.autoplayPref;i.iframe&&(t||!n&&e.documentInFocus||i.toggleEmbedAutoplay(i.iframe,!e.documentInFocus)),i.setState({forcePause:!e.documentInFocus})},i.focusContent=function(){i.shouldFocusContentDebouncer(!0)},i.loadContent=function(){i.setState(function(e){return e.canLoadContent?null:{canLoadContent:!0}})},i.unmountContent=function(){},i.contentIsHeavyToMount=function(){var e=i.props.post.media;return!!e&&H.d.has(e.type)},i.shouldFocusContentDebouncer=x()(function(e){var t=i.props.post.media,n=i.props.autoplayPref;if(t&&H.d.has(t.type)){if(i.iframe){var o=t.type===H.m.EMBED?t.provider:null;o&&!H.p.has(o)?!n&&e||i.toggleEmbedAutoplay(i.iframe,!e):e||i.pauseEmbed(i.iframe,o)}e?i.setState(function(e){return e.shouldPause||!e.canLoadContent?{canLoadContent:!0,shouldPause:!1,shouldStop:!1}:null}):i.setState(function(e){return e.shouldPause?null:{shouldPause:!0}})}},250,{leading:!0}),i.toggleEmbedAutoplay=function(e,t){if(e.contentWindow){var i=t?H.g.Pause:H.g.Play;e.contentWindow.postMessage({context:le,method:i},ce),e.contentWindow.postMessage({context:le,method:H.g.Mute},ce)}},i.pauseEmbed=function(e,t){e.contentWindow&&(t===H.q.YouTube?e.contentWindow.postMessage(JSON.stringify({event:"command",func:H.u.Pause}),ce):e.contentWindow.postMessage({context:le,method:H.g.Pause},ce))},i.onIframeLoaded=function(){var e=i.props.post.media,t=i.props.autoplayPref,n=e&&e.type===H.m.EMBED?e.provider:null;if(i.iframe&&n&&!H.p.has(n)){var o=i.state.shouldPause;(t||o)&&i.toggleEmbedAutoplay(i.iframe,o)}},i.storeChildRef=function(e){i.iframe=e},i.updateDimensions=function(){i.setState({viewportHeight:window.innerHeight,viewportWidth:window.innerWidth})},i.state={canLoadContent:e.shouldLoad||!1,forcePause:!1,shouldPause:void 0===e.shouldPause||e.shouldPause,shouldStop:void 0===e.shouldStop||e.shouldStop,viewportHeight:H.e,viewportWidth:H.f},i}return f()(t,e),u()(t,[{key:"componentWillMount",value:function(){"undefined"!=typeof window&&(this.updateDimensions(),window.addEventListener("resize",this.updateDimensions))}},{key:"componentDidMount",value:function(){var e,t=this;(e=this.props.post).media&&pe.has(e.media.type)&&(this.visibilityChangeSubscriptionId=j(function(e){t.handleVisibilityChange(e)})),this.props.scrollerItemRef&&fe(this.props.post)&&this.props.scrollerItemRef(this,this.state.canLoadContent)}},{key:"componentWillUnmount",value:function(){this.visibilityChangeSubscriptionId&&F(this.visibilityChangeSubscriptionId),this.props.scrollerItemRef&&fe(this.props.post)&&this.props.scrollerItemRef(void 0),window.removeEventListener("resize",this.updateDimensions)}},{key:"componentWillReceiveProps",value:function(e){!this.state.canLoadContent&&e.shouldLoad&&this.setState({canLoadContent:!0}),void 0!==e.shouldPause&&e.shouldPause!==this.props.shouldPause&&this.shouldFocusContentDebouncer(!e.shouldPause)}},{key:"getVideoExpandoMaxDimensions",value:function(){var e=Math.max(H.i,this.state.viewportHeight),t=Math.min(1200,16*e/9);1200===t&&(e=675);var i=void 0;i=this.state.viewportWidth>=te.g?this.state.viewportWidth<B.w?this.state.viewportWidth-ue-150:this.state.viewportWidth-ue-B.i-150:this.state.viewportWidth-150;var n=this.state.viewportHeight-150;if(t>i)e*=i/t,t=i;else if(e>n){var o=n/e;e=n,t*=o}return{maxVideoHeight:e,maxVideoWidth:t}}},{key:"getMediaInfo",value:function(e){var t=e.availableWidth,i=e.post,n=i.media&&i.media.obfuscated||"",o=i.media&&!Object(H.B)(i.media)?i.media.content:"",s=!i.media||Object(H.z)(i.media)||Object(H.A)(i.media)?[0,0]:[i.media.height,i.media.width],a=d()(s,2),r=a[0],c=a[1];if(t&&i.media&&(i.media.type===H.m.IMAGE||i.media.type===H.m.GIFVIDEO)){var l=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];if(n.width>=e)return n}}(t,i.media.resolutions);l&&(o=l.url,c=l.width,r=l.height)}else if(i&&i.media&&(!e.isListing||e.isExpando)&&(i.media.type===H.m.IMAGE||i.media.type===H.m.GIFVIDEO)){var u=void 0;(u=Object(k.b)(i.media.height,i.media.width)&&Object(k.c)(i.media.height)?function(e,t,i){for(var n=0;n<i.length;n++){var o=i[n];if(o.width>=H.e/2&&(s=e,a=t,d=o.height,r=o.width,c=s/a,l=d/r,Math.abs(c-l)<.03))return o}var s,a,d,r,c,l}(i.media.height,i.media.width,i.media.resolutions):function(e){for(var t=0;t<e.length;t++){var i=e[t];if(i.height>=H.e||i.width>=H.f)return i}}(i.media.resolutions))&&(o=u.url,c=u.width,r=u.height)}if(e.isExpando)if(c>this.state.viewportWidth)r*=this.state.viewportWidth/c,c=this.state.viewportWidth;else if(r>this.state.viewportHeight){var h=this.state.viewportHeight/r;r=this.state.viewportHeight,c*=h}var p=this.getVideoExpandoMaxDimensions(),m=p.maxVideoHeight,f=p.maxVideoWidth;if(i.media&&i.media.type===H.m.VIDEO){var v=r/c;v>H.c?(r=H.k,c=Math.min(Math.max(H.k/v,H.o),H.l)):(r=Math.min(Math.max(H.l*v,H.n),H.k),c=H.l),e.isExpando&&(r=m,c=f)}i.media&&i.media.type===H.m.EMBED&&e.isExpando&&(r=m,c=f);var b=!1;if(e.isMiniCard){var g=r/c;b=Math.abs(g-H.c)>.01}return{source:o,obfuscated:n,width:c,height:r,needsBackgroundBlur:b}}},{key:"render",value:function(){var e=this.props,t=e.className,i=e.crosspost,n=e.flairStyleTemplate,o=e.forceAspectRatio,a=e.isCommentsPage,d=e.isExpando,r=e.isListing,c=e.isNotCardView,l=e.post,u=e.showCentered,h=e.showFull,p=void 0!==h&&h,m=e.theme,f=this.state,v=f.canLoadContent,g=f.forcePause,x=f.shouldPause,w=f.shouldStop;if(!l.media)return null;var E=g||x,C=w,I=this.getMediaInfo(this.props),S=I.source,L=I.obfuscated,O=I.height,T=I.width,P=I.needsBackgroundBlur,j={showCentered:u,isListing:r,showFull:p,height:O,width:T},F=Object.assign({},j,{forceAspectRatio:o,className:t}),_=r&&!d&&(!m.subredditContext.shouldShowNSFWContent&&(l.isNSFW||!(!i||!i.isNSFW))||l.isSpoiler||!(!i||!i.isSpoiler)),B=!(!l.isSponsored||!l.source);if(L&&_)return y.a.createElement(N.a,s()({},F,{blurSrc:L}),b()(he,{isVisible:v},void 0,y.a.createElement(k.a,s()({},j,{isListing:r,isVideoThumbnail:l.media.type===H.m.VIDEO,postId:l.id,shouldBlur:_,source:L,outboundUrl:B&&l.source.outboundUrl||void 0,originalSource:S}))));switch(l.media.type){case H.m.RTJSON:var A=Object(ne.a)(l,null);if(null===A)return;return p||Object(ie.a)(l)?b()(Q,{canLoadContent:v,className:t,"data-click-id":"text",isCommentsPage:a,isExpando:d,isRichTextTruncated:l.media.isRichtextPreview,postId:l.id,showFull:p},void 0,b()(ee.b,{flairStyleTemplate:n,content:l.isMeta?ae(A,l.id):A,mediaMetadata:l.media.mediaMetadata,renderingObjectInfo:l,renderMediaAsLinks:r})):null;case H.m.TEXT:return Object(oe.a)(l)?(Object(D.c)("Text post should not include body content",{extra:{info:{post:l,isListing:r,isCommentsPage:a}}}),b()(Q,{postId:l.id,className:t,"data-click-id":"text",isCommentsPage:a,showFull:p},void 0,b()($.a,{flairStyleTemplate:n,html:l.isMeta?function(e,t,i){return e.replace('href="https://www.reddit.com/poll/'+Object(se.c)(t),'class="'+i+'" href="https://www.reddit.com/poll/'+Object(se.c)(t))}(l.media.content,l.id,re.a.hiddenLink):l.media.content}))):null;case H.m.EMBED:return this.props.isMiniCard&&l.preview&&l.preview.url?y.a.createElement(N.a,s()({},F,{alwaysWrapMedia:!0}),b()(he,{isVisible:v},void 0,b()(y.a.Fragment,{},void 0,y.a.createElement(k.a,s()({},j,{isExpando:d,isListing:r,isCrosspost:!!i,postId:l.id,shouldBlur:_,source:l.preview.url,originalSource:l.preview.url})),b()(Z.b,{})))):H.h.has(l.media.provider)?y.a.createElement(N.a,s()({},F,{alwaysWrapMedia:!0,height:d?O:H.i,width:d?T:H.i*(16/9)}),v&&b()(V.a,{childRef:this.storeChildRef,height:d?O:H.i,width:d?T:void 0,isListing:r,isResponsive:!0,onLoad:this.onIframeLoaded,showCentered:u,showFull:p,source:S,title:l.title})):y.a.createElement(N.a,s()({},F,{alwaysWrapMedia:!0}),v&&y.a.createElement(V.a,s()({},j,{isResponsive:d||l.media.provider===H.q.IFrameEmbed,title:l.title,childRef:this.storeChildRef,onLoad:this.onIframeLoaded,source:S,fullWidth:l.media.provider===H.q.IFrameEmbed})));case H.m.GIFVIDEO:var U=O,G=T;return U>H.i&&(G=T/O*(U=H.i)),y.a.createElement(N.a,s()({},F,{blurSrc:P?l.media.gifBackgroundImage:void 0}),b()(he,{isVisible:v},void 0,y.a.createElement(K.a,s()({},j,{isNotCardView:c,height:d?void 0:U,width:d?void 0:G,postId:l.id,shouldLoad:!0,shouldPause:E,source:S,originalSource:l.media.content}))));case H.m.VIDEO:var z=l.media.posterUrl||l.preview&&l.preview.url;return this.props.isMiniCard&&z?y.a.createElement(N.a,s()({},F,{alwaysWrapMedia:!0}),b()(he,{isVisible:v},void 0,b()(y.a.Fragment,{},void 0,y.a.createElement(k.a,s()({},j,{isExpando:d,isListing:r,isCrosspost:!!i,postId:l.id,shouldBlur:_,source:z,originalSource:z})),b()(Z.b,{})))):y.a.createElement(N.a,s()({},F,{alwaysWrapMedia:!0}),v&&b()(R.b,{autoPlay:"boolean"==typeof x?!x:void 0,isExpando:d,postUrl:Object(W.a)(l.permalink),shouldLoad:!0,shouldPause:E,shouldStop:C,hlsSource:l.media.hlsUrl,mpegDashSource:l.media.dashUrl,isGif:l.media.isGif,scrubberThumbSource:l.media.scrubberThumbSource,postId:l.id,callToActionSource:l.source||void 0,callToActionText:l.callToAction,isListing:r,posterUrl:l.media.posterUrl}));case H.m.IMAGE:var J=this.state.viewportHeight-150,q=this.state.viewportWidth-150,X=S;return this.props.isMiniCard&&(l.thumbnail&&Object(M.a)(l.thumbnail.url)?X=l.thumbnail.url:l.preview&&Object(M.a)(l.preview.url)&&(X=l.preview.url)),y.a.createElement(N.a,s()({},F,{blurSrc:P?X:void 0,isExpando:!!d}),b()(he,{isVisible:v},void 0,y.a.createElement(k.a,s()({},j,{isExpando:d,isListing:r,isCrosspost:!!i,maxHeight:d?J:void 0,maxWidth:d?q:void 0,postId:l.id,shouldBlur:_,source:X,outboundUrl:B&&l.source.outboundUrl||void 0,originalSource:l.media.content}))));default:return null}}}]),t}(y.a.Component);t.a=Object(E.withTheme)(ve)},"./src/reddit/helpers/canPreviewSelfText/index.ts":function(e,t,i){"use strict";var n=i("./src/reddit/helpers/postHasSelfText/index.ts");t.a=function(e){return Object(n.a)(e)&&!e.isSpoiler&&!e.isNSFW}},"./src/reddit/helpers/postHasSelfText/index.ts":function(e,t,i){"use strict";var n=i("./src/reddit/models/Media/index.ts"),o=i("./src/reddit/models/RichTextJson/index.ts");t.a=function(e){var t=e&&e.media;return!!t&&(t.type===n.m.TEXT&&!!t.content||t.type===n.m.RTJSON&&!Object(o.E)(t.richtextContent))}}}]);
//# sourceMappingURL=Legacy~CollectionCommentsPage~CommentsPage~Explore~Frontpage~GovernanceReleaseNotesModal~ModListing~ModQueu~1084d5fc.c17be6e82584e5213425.js.map