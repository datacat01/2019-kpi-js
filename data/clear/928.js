if (!window.ustream) {
    window.ustream = {}
}
if (!ustream.labels) {
    ustream.labels = {}
}(function(l) {
    l["js.common_for_all.error_occured"] = "An error occured!";
    l["js.v3.broadcast.you_have_no_channels"] = "You seem to have no channels,<br \/>be sure to create one on your <a href='\/dashboard'>dashboard<\/a>.";
    l["js.common_for_all.button_cancel"] = "Cancel";
    l["js.common_for_all.button_next_raquo"] = "Next &raquo;";
    l["js.v3.broadcast.button_broadcast"] = "Broadcast";
    l["js.v3.broadcast.select_category_title"] = "Select category";
    l["js.v3.loading.please_wait"] = "Please wait...";
    l["js.broadcastopener.interstitial_title"] = "Take control of your broadcast!";
    l["js.broadcastopener.interstitial_pro_title"] = "Pro Broadcasting";
    l["js.broadcastopener.interstitial_pro_feature_adfree"] = "Ad-Free Broadcasting";
    l["js.broadcastopener.interstitial_pro_feature_analytics"] = "Advanced Analytics";
    l["js.broadcastopener.interstitial_pro_feature_branding"] = "Custom Branded Experience";
    l["js.broadcastopener.interstitial_pro_button"] = "Go Pro Now";
    l["js.broadcastopener.interstitial_basic_title"] = "Basic";
    l["js.broadcastopener.interstitial_basic_feature_ads"] = "Ad-Supported Broadcasting";
    l["js.broadcastopener.interstitial_basic_feature_analytics"] = "Basic Analytics";
    l["js.broadcastopener.interstitial_basic_feature_branding"] = "Ustream Branded Experience";
    l["js.broadcastopener.interstitial_basic_button"] = "Remain Basic";
    l["js.broadcastopener.interstitial_noplease_label"] = "Don't show this offer to me again";
    l["js.broadcastopener.interstitial_skip_to_broadcast"] = "Skip to broadcast";
    l["js.login.broadcast.title"] = "To start broadcasting, please log in or sign up";
    l["js.v3.alert.title"] = "Alert";
    l["js.v3.alert.text"] = " ";
    l["js.v3.alert.close"] = "Close";
    l["js.v3.confirm.title"] = "Confirm";
    l["js.v3.confirm.question"] = "Are you sure you want to do that?";
    l["js.v3.confirm.ok"] = "Ok";
    l["js.v3.confirm.cancel"] = "Cancel";
    l["js.v3.validator_error.strings_not_identical"] = "The value entered does not match the value of the other field.";
    l["js.v6.validator_error.notequalto_username"] = "Username cannot be used as password.";
    l["js.v3.validator_error.not_unique_username"] = "Username already exists.";
    l["js.v3.validator_error.not_unique_email"] = "Email address already exists.";
    l["js.v3.validator_error.not_unique_channel_title"] = "Channel title already exists.";
    l["js.v3.manage_ppv_event.not_unique_event_title"] = "You already have a pay-per-view event with this title. Please choose a different event title.";
    l["js.v3.validator_error.reserved_username"] = "Reserved username!";
    l["js.v3.validator_error.default_url"] = "Please enter a valid URL. Example: http:\/\/www.example.com\/";
    l["js.v3.validator_error.invalid_channel_name"] = "Invalid channel name.";
    l["js.v3.validator_error.invalid_channel_category"] = "Invalid channel category.";
    l["js.v3.validator_error.require_password"] = "A password is required.";
    l["js.v6.validator_error.default_password"] = "Password must contain at least 7 characters.";
    l["js.v3.validator_error.require_age"] = "Age required.";
    l["js.v3.validator_error.default_required"] = "This field is required.";
    l["js.v3.validator_error.default_remote"] = "Please fix this field.";
    l["js.v3.validator_error.default_email"] = "Please enter a valid email address.";
    l["js.v3.validator_error.default_date"] = "Please enter a valid date.";
    l["js.v3.validator_error.default_dateISO"] = "Please enter a valid date (ISO).";
    l["js.v3.validator_error.default_number"] = "Please enter a valid number.";
    l["js.v3.validator_error.default_digits"] = "Please enter only digits.";
    l["js.v3.validator_error.default_creditcard"] = "Please enter a valid credit card number.";
    l["js.v3.validator_error.default_cvv"] = "Please enter a valid CVV.";
    l["js.v3.validator_error.default_equalTo"] = "Passwords do not match";
    l["js.v3.validator_error.default_accept"] = "Please enter a value with a valid extension.";
    l["js.v3.validator_error.positive_float"] = "This field must be a number, greater than zero.";
    l["js.v3.validator_error.default_maxlength"] = "Please enter no more than {0} characters.";
    l["js.v3.validator_error.default_minlength"] = "Please enter at least {0} characters.";
    l["js.v3.validator_error.default_rangelength"] = "Please enter a value between {0} and {1} characters long.";
    l["js.v3.validator_error.default_range"] = "Please enter a value between {0} and {1}.";
    l["js.v3.validator_error.default_max"] = "Please enter a value less than or equal to {0}.";
    l["js.v3.validator_error.default_min"] = "Please enter a value greater than or equal to {0}.";
    l["js.v3.validator_error.not_only_number"] = "Please don't enter only numbers.";
    l["js.v3.validator_error.dont_start_with_num"] = "Please don't start with number.";
    l["js.v3.validator_error.not_integer"] = "Please enter only numeric characters";
    l["js.v6.validator_info.password_low"] = "Password strength: low";
    l["js.v6.validator_info.password_medium"] = "Password strength: medium";
    l["js.v6.validator_info.password_high"] = "Password strength: high";
    l["js.v3.tos_common.cancel"] = "Cancel";
    l["js.v3.tos_common.submit"] = "Submit";
    l["js.ustreampro_warning.warn_content"] = "<p><span class=\"knownBalance\">Your account currently has an outstanding balance of #balance#.<\/span><span class=\"unknownBalance\">Your account currently has an outstanding balance.<\/span><\/p><p>In order to keep your channels Ad-Free and maintain your Pro Broadcasting benefits, please update your credit card information by going to your Pro Broadcasting Dashboard. Please do this as soon as possible to avoid disruption in service.<\/p><p>If you have any questions, please email our support team at <a href=\"mailto:payments@ustream.tv\">payments@ustream.tv<\/a><\/p>";
    l["js.adfree_warning.btn_close"] = "Close";
    l["js.ustreampro_warning.suspend_content"] = "<p><span class=\"knownBalance\">Your Ustream Pro Broadcasting Account has been canceled due to #balance# of unpaid invoices<\/span><span class=\"unknownBalance\">Your Ustream Pro Broadcasting Account has been canceled due to unpaid invoices<\/span> and ads have been placed back on your channels.<\/p><p>Please update your credit card information by going to your Pro Broadcasting Dashboard.<\/p><p>Once your balance has been paid, you may sign up for a new Pro Broadcasting package by going to <a href=\"http:\/\/www.ustream.tv\/ustream-pro\">http:\/\/www.ustream.tv\/ustream-pro<\/a>.<\/p>";
    l["js.experience.email_confirm_dialog.text_1"] = "You are logged in and ready to go. Don't forget to verify your email address to use all features of Ustream. Check your inbox for the verification email.";
    l["js.experience.email_confirm_dialog.continue_button"] = "Continue";
    l["js.experience.email_confirm_dialog.title_1"] = "Thanks for signing up!";
    l["js.experience.facebook_connect_dialog.text"] = "Please connect to Facebook to take full advantage of Ustream.";
    l["js.experience.facebook_connect_dialog.connect"] = "Connect to Facebook";
    l["js.experience.facebook_connect_dialog.no_thanks"] = "No, Thanks";
    l["js.experience.facebook_connect_dialog.title"] = "Connect to Facebook";
    l["js.experience.login_dialogs.common_error"] = "An error occured! Please try again!";
    l["js.login.password_tooltip"] = "Must contain at least 7 characters, including a number, an uppercase and a lowercase letter.";
    l["js.experience.signup_dialog.text"] = "Watch, Interact and Broadcast Live";
    l["js.experience.signup_dialog.email"] = "Email";
    l["js.experience.signup_dialog.username"] = "Username";
    l["js.experience.signup_dialog.password"] = "Password";
    l["js.experience.signup_dialog.retype_password"] = "Retype Password";
    l["js.experience.signup_dialog.agree"] = "I agree to the <a href=\"\/terms-popup\" target=\"_blank\">Terms of Service<\/a> and <a href=\"\/privacy-policy-popup\" target=\"_blank\">Privacy Policy<\/a>";
    l["js.experience.signup_dialog.signup_button"] = "Sign Up";
    l["js.experience.signup_dialog.already_have"] = "Already have an account?";
    l["js.experience.signup_dialog.login_here"] = "Log in";
    l["js.experience.signup_dialog.remember_me"] = "Remember me";
    l["js.experience.signup_dialog.hide"] = "Hide";
    l["js.experience.signup_dialog.show"] = "Show";
    l["js.signup_dialog.title"] = "Sign up";
    l["js.login.align_termination_overlay.text_main"] = "Your Ustream Align account is not active, therefore you can't sign in now.";
    l["js.login.align_termination_overlay.text_renew"] = "To get this account reactivated, please <a href=\"\/support-ticket\">contact us<\/a>";
    l["js.login.align_termination_overlay.close"] = "Close";
    l["js.login.align_termination_overlay.title"] = "Inactive account";
    l["js.login.combined.title"] = "Log in or sign up for Ustream";
    l["js.forgot_password.title"] = "Forgot Your Password?";
    l["js.forgot_password.title_finish"] = "Help is on the way, please check your inbox";
    l["js.login.follow.title"] = "To follow this channel, please log in or sign up";
    l["js.notificationalert.title"] = "Alert";
})(ustream.labels);
! function(c, i) {
    ustream.statik.Ajax = function() {
        var e = {
                url: "",
                type: "get",
                data: null,
                defaultErrorMessage: "",
                onSuccess: function() {},
                onError: null,
                cover: null,
                fakeResponse: null
            },
            n = {};

        function t(r, o) {
            return n[r] = n[r] || {
                options: e,
                xhr: {}
            }, o && (n[r].options = c(n[r].options, o)), n[r]
        }

        function s(r, o) {
            var e = n[r],
                t = e.options;
            e.xhr = null, o && o.success ? (t.cover && this.cover && this.uncover($(t.cover)), t.onSuccess(o)) : a.call(this, r, o)
        }

        function a(r, o) {
            var e, t = n[r],
                s = t.options;
            t.xhr = null, s.cover && this.cover && this.uncover($(s.cover)), o && "abort" === o.statusText || (e = o && o.error && o.error.message ? o.error.message : s.defaultErrorMessage ? s.defaultErrorMessage : i("js.common_for_all.error_occured"), s.onError ? s.onError(o, e) : $.dispatch("ERRORNOTIFICATION", {
                message: e
            }))
        }
        return {
            sendAjax: function(r, o) {
                o && c(this.ajaxOptions, o), t.call(this, r, o),
                    function(o) {
                        var r = n[o],
                            e = r.options;
                        return $.console.log(this), e.cover && this.cover && this.cover($(e.cover)), e.fakeResponse ? (setTimeout($.proxy(function() {
                            $.console.log("fake", e), s(o, e.fakeResponse)
                        }, this), 1e3), !1) : (n[o].xhr = $.ajax({
                            url: e.url,
                            type: e.type,
                            data: e.data,
                            dataType: "json",
                            success: $.proxy(function(r) {
                                s.call(this, o, r)
                            }, this),
                            error: $.proxy(function(r) {
                                a.call(this, o, r)
                            }, this)
                        }), r.xhr)
                    }.call(this, r)
            },
            registerAjax: function(r, o) {
                t.call(this, r, o)
            },
            abortAjax: function(r) {
                var o = n[r];
                o && o.xhr && o.xhr.abort()
            },
            setAjaxProperty: function(r, o, e) {
                var t = n[r];
                t && (t.options[o] = e)
            }
        }
    }()
}(jQuery.klass.merge, ustream.framework.i18n._t_);
! function(r) {
    var n = "ucustomSelect";

    function o(e, t) {
        var n = r(e),
            o = r.extend(!0, {}, {
                controlSelector: ".control-select",
                fakeSelectSelector: "span.select"
            }, t);

        function c() {
            n.closest(o.controlSelector).find(o.fakeSelectSelector).text(r(n.find("option:selected")).text())
        }
        return c(), n.on("change", c), n.on("keyup", c), n.on("keypress", c), n.on("updateSelect", c), {
            update: c
        }
    }
    r.fn[n] = function(t) {
        return this.each(function() {
            var e = r(this);
            e.data(n) || e.data(n, o(e, t))
        })
    }, "function" == typeof define && define("jquery-custom-select", [], function() {
        return r.fn[n]
    })
}(window.jQuery);
! function(n) {
    function e(e) {
        var t = n(this),
            o = t.prop("checked"),
            c = t.parent();
        o ? (c.addClass("checked"), c.find(".custom-toggle-before").text(c.data("on") || "on").end().find(".custom-toggle-after").text("|||")) : (c.removeClass("checked"), c.find(".custom-toggle-before").text("|||").end().find(".custom-toggle-after").text(c.data("off") || "off"))
    }
    n.fn.ucustomToggle = function() {
        return this.after('<i class="custom-toggle-before"></i><i class="custom-toggle-after"></i>'), this.each(e).on("change.toggle", e)
    }
}(window.jQuery);
ustream.classes.SimpleTpl = $.klass({
    __className: "SimpleTpl",
    _func: null,
    _value: null,
    initialize: function(i, s) {
        if ("string" != typeof i) throw void 0 !== i && $.console.log("param (defined, yet not a string): ", i), $.console.trace(), "Template is missing or param is not a string, cannot initialize!";
        this._value = i.replace(/[\r\n]/g, ""), this.options = s || {
            lazy: !1
        }, this.options.lazy || this.compile()
    },
    compile: function() {
        var i = new ustream.classes.SimpleTplParserJs;
        this._func = i.compile(this._value), this._parser = i
    },
    run: function(i) {
        var s = {
            __run: this._func,
            __parser: this._parser
        };
        return $.extend(!0, s, i), s.__run()
    }
});
ustream.classes.SimpleTplParser = $.klass({
    _autoEvalframework: !0,
    _extractContext: !0,
    _singleQuote: "__Q%Q__",
    preProcessBody: function(e) {
        return e
    },
    preProcessInner: function(e) {
        return e
    },
    modifyPreBlock: function(e) {
        return e
    },
    compile: function(e) {
        var r, t, a = this._singleQuote,
            s = "",
            n = "",
            o = this;
        return r = (e = this.preProcessBody(e)).replace(this.regex, function(e, r, t, s) {
            return r = r.replace(/'/g, a), r = o.preProcessInner(r), ("=" === e.charAt(2) ? [a, ";\n", "  __out += ", r, ";\n", "  __out += ", a] : [a, ";\n", "  ", r, "\n", "  __out += ", a]).join("")
        }), t = ("var __out = " + a + r + a + "; return __out;\n").replace(/'/g, "\\'").replace(new RegExp(a, "g"), "'"), s += "var T = this;\n", s += "$.console.log(this);/*dumpParser*/\n", this._autoEvalframework && (s += "var bind = jQuery.proxy,eBind = jQuery.proxy,merge = jQuery.klass.merge,forEach = jQuery.forEach,nullFunc = ustream.framework.nullFunc,dispatchEvent = ustream.events.dispatch,captureEvent = ustream.events.capture,nullEvent = ustream.events.nullEvent,storageGet = ustream.storage.get,storageSet = ustream.storage.set,storageRemove = ustream.storage.remove,storageClear = ustream.storage.clear,_t_ = ustream.framework.i18n._t_,_dt_ = ustream.framework.i18n._dt_,getLabel = ustream.framework.i18n.getLabel,labelize = ustream.framework.i18n._t_,dateUtils = ustream.framework.dateUtils,stringUtils = ustream.framework.stringUtils;\n"), s = this.modifyPreBlock(s), this._extractContext && (s += "try { ", s += "with(this){", n += "}", n += "} catch(e) { $.console.error(e); $.console.info('scope', this); if (this.__run) { $.console.info({evaledCode:this.__run+''}); } }"), new Function(s + t + n)
    }
});
ustream.classes.SimpleTplParserJs = ustream.classes.SimpleTplParser.extend({
    regex: /<%=?(.*?)%>/g,
    initialize: function(e) {
        $.extend(!0, this, e || {})
    }
});
define("classes/Facebook", ["events", "timer", "ustream-centrallogging", "lodash", "jsdebug", "klass", "exposedVars"], function(o, t, e, s, i, n, c) {
    return n({
        _singleton: !0,
        onSuccess: function() {},
        openerId: null,
        connectWindow: null,
        windowTimerName: "checkFBWindowClose",
        initialize: function() {
            o.capture("FACEBOOKCONNECT", s.bind(this.onConnectRequest, this)), o.capture("FACEBOOKCONNECTED", s.bind(this.onConnected, this)), o.capture("FACEBOOKREMOVEPUBLISHACTIONS", s.bind(this.removePublishActions, this)), o.capture("FACEBOOKDISCONNECT", s.bind(this.onDisconnectRequest, this)), o.capture("FACEBOOKLOGOUT", s.bind(this.onLogoutRequest, this)), o.capture("FACEBOOKSHOWPERMISSIONDIALOG", s.bind(this.showPermissionDialog, this)), o.capture("FACEBOOKSETPOSTPERMISSION", s.bind(this.setPermissions, this)), this.logger = e.create({
                subdomain: "eventtracking-log",
                tag: "eventtracking.dashboard",
                type: "web",
                callback: function(e, n) {
                    if (e) throw e;
                    i("sent log payloads", n)
                }
            })
        },
        checkWindowClose: function() {
            this.connectWindow && !this.connectWindow.closed || (t.remove(this.windowTimerName), o.dispatch("FACEBOOKCONNECTFAILURE"))
        },
        onConnectRequest: function(e) {
            var n = location.protocol + "//" + location.hostname;
            void 0 !== e && (e.eventData.openerId && (this.openerId = e.eventData.openerId), "function" == typeof e.eventData.onSuccess && (this.onSuccess = e.eventData.onSuccess)), n += c.get("networkConnections").facebook.urls.connect, n += this.openerId ? "?opener=" + this.openerId : "", n += "&pageUrl=" + c.get("pageUrl"), this.connectWindow = window.open(n, "FBWindow", "width=720, height=420, menubar=no, toolbar=no"), t.add(1e3, s.bind(this.checkWindowClose, this), this.windowTimerName);
            try {
                this.connectWindow.focus()
            } catch (e) {}
        },
        onConnected: function(e) {
            c.get("networkConnections").facebook.connected = !0;
            var n = e.eventData;
            c.get("loggedIn") && $.extend(!0, ustream.vars, n.exposedVariables || {});
            var o = {
                product: "facebook-connect",
                isSignupHappened: n.isSignupHappened,
                opener: n.opener,
                success: n.success,
                loggedInUserId: n.exposedVariables ? n.exposedVariables.loggedInUserId : 0
            };
            this.logger.send([{
                data: o
            }]), this.onSuccess.call(window, n.exposedVariables)
        },
        onDisconnectRequest: function(e) {
            $.post(c.get("networkConnections").facebook.urls.disconnect, null, s.bind(this.onDisconnectHandler, this, e), "json")
        },
        onDisconnectHandler: function(e, n) {
            n.success ? ($.extend(!0, ustream.vars, n.exposedVariables), o.dispatch("FACEBOOKDISCONNECTED"), void 0 !== e && "function" == typeof e.eventData.onDisconnect && e.eventData.onDisconnect()) : o.dispatch("ERRORNOTIFICATION", {
                message: n.error.message
            })
        },
        onLogoutRequest: function(n) {
            var o = c.get("networkConnections").facebook.urls.logout + "?rnd=" + (new Date).getTime(),
                t = this;
            require(["datasources/AjaxDataSource"], function(e) {
                e.getInstance().request({
                    url: o,
                    method: "POST",
                    dataType: "json",
                    xhrFields: {
                        withCredentials: !0
                    },
                    success: s.bind(t.onLogoutHandler, t, n),
                    error: s.bind(t.onLogoutHandler, t, n)
                })
            })
        },
        onLogoutHandler: function(e, n) {
            n.success && ($.extend(!0, c.get("networkConnections"), n.exposedVariables.networkConnections || {}), o.dispatch("FACEBOOKLOGGEDOUT", {
                exposedVariables: n.exposedVariables
            }), void 0 !== e && "function" == typeof e.eventData.onLogout && e.eventData.onLogout())
        },
        showPermissionDialog: function(e) {
            var n = e.eventData.opener || !1,
                o = c.get("networkConnections"),
                t = location.protocol + "//" + location.hostname,
                s = "publish" === n && -1 !== o.facebook.declinedScopes.indexOf("publish_actions"),
                i = "publish" !== n && -1 !== o.facebook.declinedScopes.indexOf("email");
            t += o.facebook.urls.permissionEdit, t += n ? "?opener=" + n : "", o.facebook.declinedScopes && (s || i) && (t += (-1 === t.indexOf("?") ? "?" : "&") + "rerequest=1"), this.connectWindow = window.open(t, "FBWindow", "width=720, height=420, menubar=no, toolbar=no")
        },
        setPermissions: function(e) {
            var n = e.eventData.exposedVariables.networkConnections || {};
            $.extend(!0, c.get("networkConnections"), n || {})
        },
        removePublishActions: function(n) {
            $.ajax({
                url: c.get("removeFbPublishActionsUrl"),
                type: "POST",
                success: function(e) {
                    void 0 !== e && e.success ? "function" == typeof n.eventData.onSuccess && n.eventData.onSuccess() : "function" == typeof n.eventData.onError && n.eventData.onError()
                },
                error: function() {
                    "function" == typeof n.eventData.onError && n.eventData.onError()
                }
            })
        }
    })
});
ustream.templates.broadcastDialog = '<div><div id="BroadcastDialog" class="step1" data-template="broadcastDialog"><div class="noChannel subPage"><div class="ui-dialog-body"><p><%= _t_("js.v3.broadcast.you_have_no_channels") %></p></div><div class="endBtns ui-dialog-footer"><a class="btnCancel"><span><%= _t_("js.common_for_all.button_cancel") %></span></a></div></div><div class="channelSelector subPage" data-title="<%= dialogTitle %>"><div class="broadcastInnerWrap ui-dialog-body"><p><%= dialogDescription %></p><select id="BroadcastChannelSelect"><% forEach(channels, function(channel){ %><option value="<%=channel.id %>"><%=channel.name %></option><% }); %></select></div><div class="endBtns ui-dialog-footer"><a class="btnCancel"><%= _t_("js.common_for_all.button_cancel") %></a><a class="button btnNext"><span><%= _t_("js.common_for_all.button_next_raquo") %></span></a><a class="button btnBroadcast"><span><%= _t_("js.v3.broadcast.button_broadcast") %></span></a></div></div><div class="categorySelector subPage" data-title="<%= _t_("js.v3.broadcast.select_category_title") %>" style="display:none"><div class="emptyLoading">&nbsp;</div></div></div></div>';
define("classes/LoadingWindow", ["dialog", "i18n", "klass", "lodash", "exposedVars"], function(o, i, n, t, e) {
    return n({
        options: {
            template: '<div id="LoadingWindow"><img src="' + e.get("staticUrl") + 'v6/images/ajax-loader-big.gif" /></div>',
            dialogOptions: {
                modal: !0,
                resizable: !1,
                draggable: !1,
                width: 200,
                height: 100,
                title: i("js.v3.loading.please_wait"),
                zIndex: 5e3
            }
        },
        initialize: function(i) {
            this.options = t.merge(this.options, i || {}), this.createWindow(), o(this.window, this.options.dialogOptions)
        },
        createWindow: function() {
            var i = $("#LoadingWindow");
            i.length < 1 && (i = $(this.options.template)), this.window = i
        },
        open: function() {
            o(this.window, "open")
        },
        close: function() {
            o(this.window, "close")
        },
        destroy: function() {
            o(this.window, "destroy"), this.window.remove(), this.window = null
        }
    })
});
define("classes/BroadcastOpener", ["events", "jsdebug", "dialog", "i18n", "klass", "lodash", "exposedVars"], function(o, e, t, n, i, a, r) {
    return i({
        options: {
            width: 640,
            height: 480,
            postLoginActionInterstitial: '<div id="BroadcastInterstitial" title="' + n("js.broadcastopener.interstitial_title") + '"><div class="ui-dialog-body clearAfter"><div class="interstitial-plan-column pro-column"><h2>' + n("js.broadcastopener.interstitial_pro_title") + "</h2><ul><li>" + n("js.broadcastopener.interstitial_pro_feature_adfree") + "</li><li>" + n("js.broadcastopener.interstitial_pro_feature_analytics") + "</li><li>" + n("js.broadcastopener.interstitial_pro_feature_branding") + '</li></ul><div class="plan-submit"><button type="button" class="button warning arrow button-primary button-link go-pro-option"><span>' + n("js.broadcastopener.interstitial_pro_button") + '<i></i></span></button></div></div><div class="interstitial-plan-column basic-column"><h2>' + n("js.broadcastopener.interstitial_basic_title") + "</h2><ul><li>" + n("js.broadcastopener.interstitial_basic_feature_ads") + "</li><li>" + n("js.broadcastopener.interstitial_basic_feature_analytics") + "</li><li>" + n("js.broadcastopener.interstitial_basic_feature_branding") + '</li></ul><div class="plan-submit"><button type="button" class="button default remain-basic-option"><span>' + n("js.broadcastopener.interstitial_basic_button") + '</span></button></div></div></div><div class="ui-dialog-footer clrAfter clearAfter"><div class="no-more-interstitial"><input type="checkbox" id="NoInterstitialPlease"><label for="NoInterstitialPlease">' + n("js.broadcastopener.interstitial_noplease_label") + '</label></div><div class="submit"><a id="OpenBroadcastPopup" class="remain-basic-option">' + n("js.broadcastopener.interstitial_skip_to_broadcast") + "</a></div></div></div>"
        },
        initialize: function(t, i) {
            r.get("startBroadcastUrl") ? (this.options = a.merge(this.options, i || {}), o.capture("LOGINSUCCESS", $.proxy(this.onAjaxLogin, this)), o.capture("REQUIREBROADCASTSTART", $.proxy(this.startBroadcast, this)), this.target = $(t), this.target.click($.proxy(this.onBroadcastOpenerClick, this))) : e("No broadcast opener on this   page.")
        },
        openBroadcasterPage: function(t) {
            t || (t = r.get("isOwner") && r.get("categoryId") && r.get("bcPageUrl") ? r.get("bcPageUrl") : r.get("startBroadcastUrl")), window.open(t, "_blank")
        },
        onBroadcastOpenerClick: function(t) {
            var i = $(t.target).closest("a"),
                e = r.get("locale"),
                a = r.get("isProUser"),
                s = r.get("isAlignUser");
            if (t.preventDefault(), i.is(this.target) && !i.hasClass("disabled")) {
                if (!r.get("loggedIn")) return void o.dispatch("REQUIRELOGIN", {
                    action: "broadcast",
                    gaTriggerLabel: "Go Live Button",
                    dialogTitle: n("js.login.broadcast.title")
                });
                r.get("loggedIn") && o.dispatch("STOPFLASHMOVIES"), this.trackOpener(t), $.cookie("noInterstitial") || a || s || "ja_JP" === e || "ko_KR" === e || !this.options.postLoginActionInterstitial ? this.openBroadcasterPage() : this.openBroadcastInterstitial()
            }
        },
        trackOpener: function() {},
        startBroadcast: function(t) {
            var i = t.eventData.broadcastUrl;
            i && this.openBroadcasterPage(i)
        },
        onAjaxLogin: function(t) {
            var i = t.eventData.action,
                e = r.get("locale"),
                a = r.get("isProUser");
            i && "broadcast" === i && ($.cookie("noInterstitial") || a || "ja_JP" === e || "ko_KR" === e || !this.options.postLoginActionInterstitial ? window.open(r.get("startBroadcastUrl"), "_blank") : this.openBroadcastInterstitial())
        },
        openBroadcastInterstitial: function() {
            $("#BroadcastInterstitial").length < 1 && (t($(this.options.postLoginActionInterstitial).find(".remain-basic-option").click($.proxy(function(t) {
                t.preventDefault(), this.setInterstitialCookie(), this.closeInterstitial(), this.openBroadcasterPage(!1)
            }, this)).end().find(".go-pro-option").click($.proxy(function() {
                this.setInterstitialCookie(), this.closeInterstitial(), this.redirectToPro()
            }, this)).end(), {
                modal: !0,
                resizable: !1,
                draggable: !1,
                width: 480,
                autoOpen: !0,
                classes: {
                    "ui-dialog": "fixed"
                },
                close: $.proxy(this.onInterstitialClose, this)
            }), this.broadcastOnDialogClose(), this.setTracks()), t($("#BroadcastInterstitial"), "open"), this.trackInterstitial()
        },
        redirectToPro: function() {
            window.open("https://" + window.location.host + "/platform/plans", "_blank")
        },
        setInterstitialCookie: function() {
            if ($("#NoInterstitialPlease").is(":checked")) {
                var t = new Date;
                t.setMonth(t.getMonth() + 3), $.cookie("noInterstitial", 1, {
                    expires: t
                })
            }
        },
        broadcastOnDialogClose: function() {
            $("#BroadcastInterstitial").prev(".ui-dialog-titlebar").find(".ui-dialog-titlebar-close").click($.proxy(function() {
                this.openBroadcasterPage()
            }, this))
        },
        closeInterstitial: function() {
            t($("#BroadcastInterstitial"), "close")
        },
        trackInterstitial: function() {},
        setTracks: function() {
            $("#BroadcastInterstitial .go-pro-option").click($.proxy(function() {
                $("#NoInterstitialPlease").is(":checked") ? "checked" : "unchecked"
            }, this)), $("#BroadcastInterstitial .plan-submit .remain-basic-option").click($.proxy(function() {
                $("#NoInterstitialPlease").is(":checked") ? "checked" : "unchecked"
            }, this)), $("#BroadcastInterstitial #OpenBroadcastPopup").click($.proxy(function() {
                $("#NoInterstitialPlease").is(":checked") ? "checked" : "unchecked"
            }, this))
        },
        onInterstitialClose: function(t) {
            t.which || t.keyCode, t.originalEvent && t.originalEvent.type && t.originalEvent.type
        }
    })
});
define("classes/Header/HeaderMenuView", ["abstracts/View"], function(e) {
    return e.extend({
        container: "#Header",
        mainMenuClass: ".dd-toggle",
        subMenuClass: ".dd-content",
        subMenuIframe: null,
        openDelay: !1,
        hideDelay: !1,
        domEvents: {
            "mouseenter .dd-toggle": "onMouseIn",
            "mouseenter .dd-content": "onMouseIn",
            "mouseleave .dd-toggle": "onMouseOut",
            "mouseleave .dd-content": "onMouseOut"
        },
        initialize: function() {
            this.parent()
        },
        onMouseIn: function(e) {
            var n = $(e.target),
                s = n.parent();
            n.hasClass("user-picture") && (s = s.closest(".user-menu")), this.hideDelay && window.clearTimeout(this.hideDelay), this.openDelay && n.closest(this.subMenuClass).length && window.clearTimeout(this.openDelay), s.is(".hover") || (n.closest(this.subMenuClass).length || !this.isOpenedMenu ? s.find(this.mainMenuClass).length && (this.openDelay = setTimeout($.proxy(function() {
                var e = $(this.mainMenuClass).parent(".hover");
                this.hideSubmenu(e), this.showSubmenu(s), this.isOpenedMenu = !0
            }, this), 200)) : this.openDelay = window.setTimeout($.proxy(function() {
                var e = $(this.mainMenuClass).parent(".hover");
                this.hideSubmenu(e), this.showSubmenu(s), this.isOpenedMenu = !0
            }, this), 200))
        },
        onMouseOut: function(e) {
            var n = $(e.currentTarget).parent();
            clearTimeout(this.openDelay), this.hideDelay && window.clearTimeout(this.hideDelay), this.hideDelay = window.setTimeout($.proxy(function() {
                this.hideSubmenu(n), this.isOpenedMenu = !1
            }, this), 500)
        },
        showSubmenu: function(e) {
            e.addClass("hover"), this.isOpenedMenu = !0, this.emit("subMenuShown")
        },
        hideSubmenu: function(e) {
            e || (e = this.container.find(".hover")), e.removeClass("hover"), this.emit("subMenuHid")
        },
        showLoggedInParts: function(e) {
            var n = $("#HeaderLogin"),
                s = $("#Header .mainmenu");
            n.find(".login").remove(), n.append(e), s.find(".din").removeClass("din"), s.find(".login-signup").remove()
        }
    })
});
define("classes/Header/HeaderMenuController", ["abstracts/Controller", "classes/Header/HeaderMenuView", "events"], function(n, e, t) {
    return n.extend({
        viewEvents: {
            subMenuShown: "onSubMenuShown",
            subMenuHid: "onSubMenuHid"
        },
        initialize: function() {
            this.view = new e, t.capture("LOGINSUCCESS", $.proxy(this.onLogin, this)), this.parent()
        },
        onSubMenuShown: function() {
            t.dispatch("SHOWSUBMENU")
        },
        onSubMenuHid: function() {
            t.dispatch("HIDESUBMENU")
        },
        onLogin: function(n) {
            n.eventData.dropdownContent && this.view.showLoggedInParts(n.eventData.dropdownContent)
        }
    })
});
define("classes/Header/HeaderView", ["abstracts/View"], function(t) {
    return t.extend({
        container: "#Header",
        domEvents: {
            "click .logout": "onLogoutClick"
        },
        initialize: function() {
            this.parent()
        },
        onLoginClick: function(t) {
            !$(t.target).hasClass("standalone") && $("body").hasClass("login-data-checked") && (t.preventDefault(), this.emit("startLogin"))
        },
        loggingOut: !1,
        startLogout: function() {
            this.container.find(".logout").click()
        },
        onLogoutClick: function(t) {
            var e = $(t.currentTarget),
                n = e.attr("href");
            t.preventDefault(), this.loggingOut || (e.addClass("locked").animate({
                opacity: .5
            }), this.emit("startLogout", {
                url: n
            }), this.loggingOut = !0)
        },
        onLogoutSuccess: function() {
            window.location.reload()
        },
        changeUserPicture: function(t) {
            $("#HeaderLogin img.user-picture").attr("src", t)
        }
    })
});
define("classes/Header/HeaderController", ["abstracts/Controller", "classes/Header/HeaderView", "classes/Header/HeaderMenuController", "datasources/AjaxDataSource", "classes/Authentication/LoggedInDataSyncer", "classes/BroadcastOpener", "events", "exposedVars"], function(e, t, o, s, a, r, n, i) {
    return e.extend({
        viewEvents: {
            startLogin: "onStartLogin",
            startLogout: "onStartLogout"
        },
        startBroadcastSelector: ".start-broadcast",
        initialize: function() {
            this.view = new t, this.parent(), new r($(this.startBroadcastSelector)), new o, n.capture("REQUIRELOGOUT", $.proxy(this.view.startLogout, this.view)), n.capture("FACEBOOKCONNECTED", $.proxy(this.onFacebookConnected, this))
        },
        onStartLogin: function() {
            n.dispatch("REQUIRELOGIN", {
                allowRedirect: !0,
                gaTriggerLabel: "Header Link"
            })
        },
        onStartLogout: function(e) {
            var t = e.url;
            a.clear(), n.dispatch("DISABLEFACEBOOKAUTOLOGIN"), n.dispatch("LOGOUT"), s.getInstance().request({
                url: t,
                xhrFields: {
                    withCredentials: !0
                },
                success: $.proxy(this.onLogoutResponse, this),
                error: $.proxy(this.onLogoutResponse, this)
            })
        },
        onLogoutResponse: function() {
            this.view.onLogoutSuccess()
        },
        onFacebookConnected: function(e) {
            if (i.get("loggedIn") && e.eventData && e.eventData.exposedVariables) {
                var t = e.eventData.exposedVariables.userPicture;
                this.view.changeUserPicture(t)
            }
        }
    })
});
! function(s) {
    define("classes/TimeZoneCorrector", ["events", "klass"], function(t, a) {
        return a({
            initialize: function() {
                this.correct(), t.capture("CORRECTTIMEZONE", $.proxy(this.correct, this))
            },
            correct: function() {
                $(".dateFormat").forEach(function(t) {
                    var a, e = $(t),
                        r = 1e3 * parseInt(e.attr("data-timestamp"), 10),
                        o = e.attr("data-dateformat");
                    isNaN(r) ? e.removeClass("dateFormat") : (a = o ? s.dateFormat(r, o) : s.dateFormat(r), e.html(a).removeClass("dateFormat"))
                }), $(".date-in-title").forEach(function(t) {
                    var a, e = $(t),
                        r = 1e3 * parseInt(e.attr("data-titledate"), 10),
                        o = e.attr("data-dateformat"),
                        i = e.attr("title");
                    isNaN(r) ? e.removeClass("date-in-title") : (a = o ? s.dateFormat(r, o) : s.dateFormat(r), e.attr("title", i.replace(/#ts#/g, a)).removeClass("date-in-title"))
                })
            }
        })
    })
}(ustream.framework.dateUtils);
ustream.templates.alertHandler = '<div title="<%= title %>"><input type="hidden" data-template="alertHandler" /><div class="ui-dialog-body"><p class="dialogText alertText"><%= text %></p></div><% if (btnCloseText) { %><div class="ui-dialog-footer endBtns"><a tabindex="0" role="button" class="button close <%= btnCloseClass %>"><span><%= btnCloseText %></span></a></div><% } %></div>';
ustream.templates.confirmHandler = '<div title="<%= title %>"><input type="hidden" data-template="confirmHandler" /><div class="ui-dialog-body"><p class="dialogText confirmQuestion"><%= question %></p></div><div class="ui-dialog-footer endBtns"><a class="button action"><span><%= btnConfirmText %></span></a><span class="or">or</span><a class="cancel secondary"><%= btnCancelText %></a></div></div>';
! function(t) {
    ustream.classes.AlertHandler = $.klass({
        options: {
            dialogData: {
                title: t("js.v3.alert.title"),
                text: t("js.v3.alert.text"),
                btnCloseText: t("js.v3.alert.close")
            },
            dialogOptions: {
                closeOnEscape: !1,
                hideCloseButton: !0,
                modal: !0,
                autoOpen: !1,
                width: 280,
                minHeight: 100,
                hideTitle: !1,
                dialogClass: "alertDialog",
                zIndex: 2e3
            },
            onClose: function() {},
            autoHideOnOk: !0,
            template: ustream.templates.alertHandler
        },
        origEvent: null,
        initialize: function(t) {
            this.options = $.klass.merge(this.options, t || {}), this.options.template = new ustream.classes.SimpleTpl(this.options.template), this._setDialog(), this._setEvents()
        },
        _setDialog: function() {
            this.options.dialogOptions.hideCloseButton && (this.options.dialogOptions.open = function() {
                $(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide()
            }), this.dialogEl = $(this.options.template.run(this.options.dialogData)), this.dialogEl.dialog(this.options.dialogOptions), this.options.dialogOptions.hideTitle || !1 === this.options.dialogData.title ? this.hideTitle() : this.showTitle()
        },
        _setEvents: function() {
            this.dialogEl.find(".endBtns > a").click($.proxy(this.onClick, this)), this.dialogEl.parent().find(".ui-dialog-titlebar-close").click($.proxy(this.onClick, this))
        },
        open: function(t, i) {
            t && (t.preventDefault(), t.stopPropagation(), this.origEvent = t), this.payLoad = i, this.dialogEl.dialog("open")
        },
        close: function(t) {
            t && (t.preventDefault(), t.stopPropagation(), this.origEvent = t), this.dialogEl.dialog("close")
        },
        destroy: function() {
            this.dialogEl.dialog("destroy")
        },
        onClick: function(t) {
            var i = t;
            this.origEvent && !this.origEvent.isNull && (i = this.origEvent), t.preventDefault(), t.stopPropagation(), this.onClose(i, this.payLoad), this.options.autoHideOnOk && this.dialogEl.dialog("close")
        },
        onClose: function(t, i) {
            this.options.onClose(t, i), $.dispatch("ALERTCLOSE", t, this)
        },
        setText: function(t) {
            this.dialogEl.find("p.dialogText").html(t)
        },
        setTitle: function(t) {
            this.dialogEl.parent().find(".ui-dialog-title").html(t)
        },
        setCloseBtnText: function(t) {
            this.dialogEl.find(".endBtns > a.close").html(t)
        },
        hideTitle: function() {
            this.dialogEl.parent().find(".ui-dialog-title").parent().hide()
        },
        showTitle: function() {
            this.dialogEl.parent().find(".ui-dialog-title").parent().show()
        }
    })
}(ustream.framework.i18n._t_);
! function(t) {
    ustream.classes.ConfirmHandler = ustream.classes.AlertHandler.extend({
        options: {
            dialogData: {
                title: t("js.v3.confirm.title"),
                question: t("js.v3.confirm.question"),
                btnConfirmText: t("js.v3.confirm.ok"),
                btnConfirmUrl: null,
                btnCancelText: t("js.v3.confirm.cancel")
            },
            dialogOptions: {
                hideCloseButton: !1
            },
            onConfirm: function() {},
            onCancel: function() {},
            autoHideOnConfirm: !0,
            template: ustream.templates.confirmHandler
        },
        initialize: function(t) {
            this.options = $.klass.merge(this.options, t || {}), this.parent()
        },
        onClick: function(t) {
            var n = $(t.target).closest("a"),
                i = t;
            this.origEvent && !this.origEvent.isNull && (i = this.origEvent), t.preventDefault(), t.stopPropagation(), !this.options.autoHideOnConfirm && n.hasClass("action") || this.dialogEl.dialog("close"), n.hasClass("action") || n.parent().hasClass("action") ? this.onConfirm(i, this.payLoad) : this.onCancel(i, this.payLoad)
        },
        onConfirm: function(t, n) {
            this.options.dialogData.btnConfirmUrl && (window.location.href = this.options.dialogData.btnConfirmUrl), this.options.onConfirm(t, n), $.dispatch("CONFIRM", t, this)
        },
        onCancel: function(t, n) {
            this.options.onCancel(t, n), $.dispatch("CANCEL", t, this)
        }
    })
}(ustream.framework.i18n._t_);
define("classes/UserNotification", ["i18n", "events", "jsdebug", "klass", "lodash"], function(n, t, o, e, s) {
    return e({
        _singleton: !0,
        options: {
            mainClassName: "pushdown-notification",
            iconClassName: "pushdown-icon",
            template: '<div id="UstreamUserNotification" class="pushdown-notification-wrapper"><div class="pushdown-notification"><span class="pushdown-icon"></span><p class="pushdown-message"></p><a class="pushdown-close"></a></div></div>',
            sticky: !1,
            delay: 6e3,
            queueDelay: 500,
            closeable: !0,
            withoutMovement: !1
        },
        initialize: function(e) {
            this.options = s.merge(this.options, e || {}), this.element = $(this.options.template), $("body").addClass("userNotification").append(this.element), this.closeElement = this.element.find("a.pushdown-close"), this.closeElement.on("click", s.bind(function() {
                this.hide()
            }, this)), this.timer = 0, this.stickyTimer = 0, this.queue = [], t.capture("NOTIFICATION", s.bind(this.enqueue, this, "notice")), t.capture("SUCCESSNOTIFICATION", s.bind(this.enqueue, this, "success")), t.capture("ERRORNOTIFICATION", s.bind(this.enqueue, this, "error")), t.capture("INFONOTIFICATION", s.bind(this.enqueue, this, "info")), t.capture("AJAXNOTIFICATION", s.bind(this.ajaxMessage, this)), t.capture("HIDENOTIFICATION", s.bind(this.hide, this)), t.capture("CLEARLASTNOTIFICATION", s.bind(this.hide, this)), t.capture("CLEARALLNOTIFICATION", s.bind(this.clearAll, this))
        },
        ajaxMessage: function(e) {
            var t, s = e.eventData,
                i = n ? n("js.common_for_all.error_occured") : "Server error";
            if (s.response || (o("AJAXNOTIFICATION: no response."), s.response = {
                    success: !1,
                    error: {
                        message: i,
                        code: "local"
                    }
                }), !(t = s.response).success) return t.error && t.error.message ? s.message = t.error.message : s.message = i, void this.enqueue("error", e);
            t.success && s.successMessage && (s.message = s.successMessage, this.enqueue("success", e))
        },
        enqueue: function(e, t) {
            if ("string" == typeof e) {
                var s = t.eventData.message || e,
                    i = void 0 !== t.eventData.delay ? t.eventData.delay : this.options.delay,
                    n = void 0 !== t.eventData.sticky ? t.eventData.sticky : this.options.sticky,
                    o = void 0 !== t.eventData.closeable ? t.eventData.closeable : this.options.closeable,
                    a = void 0 !== t.eventData.withoutMovement ? t.eventData.withoutMovement : this.options.withoutMovement;
                this.queue.push({
                    type: e,
                    message: s,
                    sticky: n,
                    delay: i,
                    closeable: o,
                    withoutMovement: a
                }), 1 === this.queue.length && this.showNext(), 2 !== this.queue.length || !this.queue[0].sticky || this.stickyTimer || this.element.is(":animated") || this.hide()
            }
        },
        showNext: function() {
            if (this.queue.length) {
                var e = this.queue[0];
                this.element.find("." + this.options.mainClassName).attr("class", this.options.mainClassName + " " + this.options.mainClassName + "-" + e.type), this.element.find("." + this.options.iconClassName).attr("class", this.options.iconClassName + " " + this.options.iconClassName + "-" + e.type), this.element.find("p").html(e.message), e.sticky ? (e.closeable ? this.closeElement.show() : this.closeElement.hide(), this.element.find("." + this.options.mainClassName).addClass("sticky-notification"), this.stickyTimer = setTimeout(s.bind(this.onStickyTimeout, this), e.delay)) : (this.closeElement.hide(), this.timer = setTimeout(s.bind(this.hide, this), e.delay)), e.withoutMovement ? this.element.css({
                    top: 0
                }).show().animate({
                    opacity: 1
                }, 250, "linear", s.bind(this.onShowComplete, this)) : this.element.css({
                    opacity: 1
                }).show().animate({
                    top: 0
                }, 350, "easeOutBack", s.bind(this.onShowComplete, this)), $(document).one("keyup", s.bind(this.onKeyUp, this))
            }
        },
        onShowComplete: function() {
            this.element.removeClass(this.options.mainClassName + "-hidden")
        },
        hide: function() {
            clearTimeout(this.timer), this.timer = 0, clearTimeout(this.stickyTimer), this.stickyTimer = 0, $(document).unbind("keyup", s.bind(this.onKeyUp, this)), this.options.withoutMovement ? this.element.animate({
                opacity: 0
            }, 300, "linear", s.bind(this.onHideComplete, this)) : this.element.animate({
                top: -80,
                opacity: 0
            }, 350, "easeInBack", s.bind(this.onHideComplete, this)), this.element.addClass(this.options.mainClassName + "-hidden")
        },
        onHideComplete: function() {
            this.element.find("p").empty(), this.element.hide(), this.element.find("." + this.options.mainClassName).removeClass("sticky-notification"), this.queue.shift(), this.queue.length && setTimeout(s.bind(this.showNext, this), this.options.queueDelay)
        },
        onStickyTimeout: function() {
            this.stickyTimer = 0, 1 < this.queue.length && this.hide()
        },
        clearAll: function() {
            this.queue = [this.queue[0]], this.hide()
        },
        onKeyUp: function(e) {
            27 === e.keyCode && this.hide()
        }
    })
});
define("classes/PrettyDateUpdater", ["events", "timer", "stringUtils", "lodash", "klass"], function(s, e, o, i, t) {
    return t({
        options: {
            selector: ".prettyDate",
            interval: 3e4
        },
        initialize: function(t) {
            this.options = i.merge(this.options, t || {}), this.process(), this.timer = e.add(this.options.interval, i.bind(this.process, this)), s.capture("PRETTYDATENOW", $.proxy(this.process, this))
        },
        process: function() {
            $(this.options.selector).each(function(t, s) {
                var e = $(s),
                    i = e.attr("data-timestamp");
                i && e.text(o.prettyDate(1 * i))
            })
        }
    })
});
! function(e) {
    ustream.classes.ValidatorInit = $.klass({
        _exclusive: !0,
        validatorMethods: {
            notEqualToString: {
                method: function(e, r, t, a) {
                    return r != a
                },
                message: e("js.v3.validator_error.strings_not_identical")
            },
            notEqualTo: {
                method: function(e, r, t, a) {
                    return r != $(a).val()
                },
                message: e("js.v6.validator_error.notequalto_username")
            },
            uniquename: {
                method: function(e, r, t) {
                    return this.remoteValidatorMethod(e, r, t)
                },
                message: e("js.v3.validator_error.not_unique_username")
            },
            freeusername: {
                method: function(e, r, t) {
                    return this.remoteValidatorMethod(e, r, t)
                },
                message: e("js.v3.validator_error.not_unique_username")
            },
            uniquemail: {
                method: function(e, r, t) {
                    return this.remoteValidatorMethod(e, r, t)
                },
                message: e("js.v3.validator_error.not_unique_email")
            },
            uniquechanneltitle: {
                method: function(e, r, t) {
                    var a = {};
                    return a.channelId = ustream.vars.channelId || 0, this.remoteValidatorMethod(e, r, t, a)
                },
                message: e("js.v3.validator_error.not_unique_channel_title")
            },
            uniquenewchanneltitle: {
                method: function(e, r, t) {
                    var a = {
                        channelId: 0
                    };
                    return this.remoteValidatorMethod("uniquechanneltitle", r, t, a)
                },
                message: e("js.v3.validator_error.not_unique_channel_title")
            },
            uniqueeventtitle: {
                method: function(e, r, t) {
                    var a = {};
                    return a.channelId = ustream.vars.channelId, a.eventId = ustream.vars.validatorEventId || 0, this.remoteValidatorMethod(e, r, t, a)
                },
                message: e("js.v3.manage_ppv_event.not_unique_event_title")
            },
            vanityurl: {
                method: function(e, r, t) {
                    return this.remoteValidatorMethod(e, r, t)
                },
                message: e("js.v3.validator_error.reserved_username")
            },
            httpurl: {
                method: function(e, r, t) {
                    return $(t).parents("form").validate().optional(t) || /^https?:\/\//.test(r)
                },
                message: e("js.v3.validator_error.default_url")
            },
            validchannel: {
                method: function(e, r, t) {
                    return this.remoteValidatorMethod(e, r, t)
                },
                message: e("js.v3.validator_error.invalid_channel_name")
            },
            validchannelcategory: {
                method: function(e, r, t) {
                    return this.remoteValidatorMethod(e, r, t)
                },
                message: e("js.v3.validator_error.invalid_channel_category")
            },
            channelpassword: {
                method: function(e, r, t) {
                    return !$("input[name='settings[protected]']").is(":checked") || !(r.length < 1)
                },
                message: e("js.v3.validator_error.require_password")
            },
            userpassword: {
                method: function(e, r, t) {
                    return /.{5,}/.test(r)
                },
                message: e("js.v6.validator_error.default_password")
            },
            dontstartnum: {
                method: function(e, r, t) {
                    return !/^\d/i.test(r)
                }
            },
            birthdayover13: {
                method: function(e, r, t) {
                    return !0
                },
                message: e("js.v3.validator_error.require_age")
            },
            positiveFloat: {
                method: function(e, r, t) {
                    return 0 < Number(r)
                }
            },
            requiredAndNot0: {
                method: function(e, r, t) {
                    return "" !== (r = $.trim($(t).val())) && 0 !== parseInt(r, 10)
                },
                message: e("js.v3.validator_error.default_required")
            },
            integer: {
                method: function(e, r, t) {
                    var a = parseInt(r, 10);
                    return isNaN(a) || a === +r
                }
            },
            testMethod: {
                method: function(e, r, t) {
                    return !(r.length < 1)
                },
                message: "Test message"
            }
        },
        initialize: function() {
            $.validator.messages = {
                required: e("js.v3.validator_error.default_required"),
                remote: e("js.v3.validator_error.default_remote"),
                email: e("js.v3.validator_error.default_email"),
                userpassword: e("js.v6.validator_error.default_password"),
                notEqualTo: e("js.v6.validator_error.notequalto_username"),
                url: e("js.v3.validator_error.default_url"),
                date: e("js.v3.validator_error.default_date"),
                dateISO: e("js.v3.validator_error.default_dateISO"),
                number: e("js.v3.validator_error.default_number"),
                digits: e("js.v3.validator_error.default_digits"),
                creditcard: e("js.v3.validator_error.default_creditcard"),
                cvv: e("js.v3.validator_error.default_cvv"),
                equalTo: e("js.v3.validator_error.default_equalTo"),
                accept: e("js.v3.validator_error.default_accept"),
                positiveFloat: e("js.v3.validator_error.positive_float"),
                maxlength: $.validator.format(e("js.v3.validator_error.default_maxlength")),
                minlength: $.validator.format(e("js.v3.validator_error.default_minlength")),
                rangelength: $.validator.format(e("js.v3.validator_error.default_rangelength")),
                range: $.validator.format(e("js.v3.validator_error.default_range")),
                max: $.validator.format(e("js.v3.validator_error.default_max")),
                min: $.validator.format(e("js.v3.validator_error.default_min")),
                requiredAndNot0: e("js.v3.validator_error.default_required"),
                dontstartnum: $.validator.format(e("js.v3.validator_error.dont_start_with_num")),
                integer: e("js.v3.validator_error.not_integer")
            }, $.forEach(this.validatorMethods, this.addValidatorMethod, this)
        },
        addValidatorMethod: function(e, r) {
            $.validator.addMethod(r, $.proxy(e.method, this, r), e.message)
        },
        remoteValidatorMethod: function(e, r, t, a) {
            var o, n = $(t).parents("form").validate(),
                s = n.previousValue(t),
                i = $.klass.merge({
                    value: r
                }, a || {});
            return $(t).addClass("loading"), o = $.ajax({
                url: window.location.origin.replace("http:", "https:") + "/ajax/validate.json/" + e,
                data: i,
                dataType: "json",
                type: "post",
                xhrFields: {
                    withCredentials: !0
                },
                mode: "abort",
                port: "validate" + t.name,
                success: $.proxy(this.responseHandler, this, n, t, s, r)
            }), n.ajaxCalls.push(o), "pending"
        },
        responseHandler: function(e, r, t, a, o) {
            var n, s, i, d;
            if ($(r).removeClass("loading"), o) {
                try {
                    e.settings.messages[r.name].remote = t.originalMessage
                } catch (e) {}(n = o.success || !1) ? (s = e.formSubmitted, e.prepareElement(r), e.formSubmitted = s, e.successList.push(r), e.showErrors()) : (i = {}, d = t.message = o.error.message || e.defaultMessage(r, "remote"), i[r.name] = $.isFunction(d) ? d(a) : d, e.showErrors(i)), t.valid = n, e.stopRequest(r, n)
            }
        }
    }), ustream.classes.ValidatorInit.cardExpiredValidatior = function(e, r, l, u) {
        var v = $(e),
            m = $(r);
        return u = "object" == typeof u ? u : {
                valid: "valid",
                error: "error"
            },
            function() {
                var e, r, t, a, o, n, s, i = v.val(),
                    d = m.val();
                return r = i, t = d, n = new Date, new Date, s = !1, "" === r || "" === t || (a = n.getFullYear(), o = n.getMonth(), s = +r < a || +r === a && +t < o + 1), e = !s, l || (v.toggleClass(u.error, !e).toggleClass(u.valid, e), m.toggleClass(u.error, !e).toggleClass(u.valid, e)), e
            }
    }
}(ustream.framework.i18n._t_);
! function(i) {
    ustream.classes.Validator = $.klass({
        options: {
            form: {},
            rules: {},
            submitHandler: function() {},
            errorClass: "error",
            outerErrorClass: "uError",
            onkeyup: !1,
            onfocusout: "onfocusout",
            resetOnStart: !1,
            wrapper: "div",
            distanceError: 20,
            errorHideEvent: "ValidatorHideErrors",
            isModal: !1,
            originalZindex: "1",
            originalPosition: "relative",
            hideOtherFormsErrors: !0,
            errorElement: "label",
            errorHandler: !1,
            onErrorPlacement: null,
            template: '<b class="arrow"></b><b class="subArrow"></b><span class="ui-icon-red ui-icon-alert"></span>'
        },
        initialize: function(t) {
            return this.options.showErrors = $.proxy(this.onShowErrors, this), this.options.errorPlacement = $.proxy(this.onErrorPlacement, this), $.extend(!0, this.options, t), !0 === this.options.debug && $.console.log(this.options), this.options.form = $(this.options.form), this.options.form.length < 1 ? {} : (!1 !== this.options.isModal && (this.options.isModal = 0 < this.options.form.parents(".ui-dialog").length), this.options.isModal && "absolute" !== this.options.form.css("position") && this.options.form.css("position", "relative"), this.offsetLefts = {}, this.offsetTops = {}, this.options.onfocusout && "string" == typeof this.options.onfocusout && (this.options.onfocusout = this[this.options.onfocusout]), this.validateObject = this.options.form.validate(this.options), this.options.addRules && this.addRules(this.options.addRules), this.validateObject.reCheck = $.proxy(this.reCheck, this), this.validateObject.addRules = $.proxy(this.addRules, this), this.validateObject.hideAllErrors = $.proxy(this.hideAllErrors, this), this.validateObject.ajaxCalls = [], this.options.hideOtherFormsErrors && ($.capture(this.options.errorHideEvent, $.proxy(this.onGlobalHideError, this)), this.options.form.find("input,textarea,select").focus($.proxy(this.onFormFocus, this))), this.options.resetOnStart && this.validateObject.resetForm(), this.validateObject)
        },
        onFormFocus: function() {
            this.options.isModal && ("absolute" !== this.options.originalPosition && this.options.form.css("position", "relative"), this.options.form.css("zIndex", 1e4)), $.dispatch(this.options.errorHideEvent, {
                senderInstaId: this.__instaId
            })
        },
        onGlobalHideError: function(t) {
            this.__instaId !== t.eventData.senderInstaId && (this.options.isModal && (this.options.form.css("zIndex", this.options.originalZindex), this.options.form.css("position", this.options.originalPosition)), this.hideAllErrors())
        },
        hideAllErrors: function() {
            for (var t = this.validateObject.ajaxCalls.length; t--;) try {
                this.validateObject.ajaxCalls[t].abort()
            } catch (t) {}
            this.validateObject.reset(), this.options.form.find(".uError").remove().end().find(".error").removeClass("error").end().find(".loading").removeClass("loading").end().find(".valid").removeClass("valid").end()
        },
        onErrorPlacement: function(t, o) {
            if (this.options.onErrorPlacement) return this.options.onErrorPlacement(t, o);
            t.addClass("uError").prepend(this.options.template), o.after(t.css("visibility", "hidden")), this.errorMessagePosition(t, o), t.css("visibility", "visible")
        },
        onShowErrors: function(t, o) {
            this.options.errorHandler && this.options.errorHandler(), this.validateObject.errorContext.find(".tip").if_(this.validateObject.numberOfInvalids()).hide().else_().show(), $.dispatch(this.options.errorHideEvent, {
                senderInstaId: this.__instaId
            }), this.validateObject.defaultShowErrors(), this.formatErrorUpdate(t, o)
        },
        formatErrorUpdate: function(t, s) {
            if (0 < s.length) {
                var i, r, e = this.validateObject;
                $.forEach(t, function(t, o) {
                    e.errorContext.find("[name='" + o + "']"), i = $([s[0].element]), r = e.errorsFor(i[0]), this.options.wrapper && (r = r.parent()), this.options.onErrorPlacement && this.options.onErrorPlacement(r, i), this.errorMessagePosition(r, i)
                }, this)
            }
        },
        errorMessagePosition: function(t, o) {
            if (!this.options.onErrorPlacement) {
                var s, i, r, e, n, a, h, l, d, f, p = 0 < o.siblings("label").length ? o.siblings("label") : o.closest("label"),
                    c = o.outerHeight(),
                    u = t.offset(),
                    m = t.outerWidth(),
                    v = t.outerHeight(),
                    E = u.top;
                "radio" == o.attr("type") || "checkbox" == o.attr("type") ? (s = p.offset(), i = p.position(), r = p.outerWidth()) : (s = o.offset(), i = o.position(), r = o.outerWidth()), e = s.left, n = s.top, f = r + e + m + this.options.distanceError > $(window).width(), t.removeClass("toLeft").removeClass("toRight").addClass(f ? "toLeft" : "toRight"), (d = E + (a = this._getOffsetTop(n, E, v, c)) - (((l = this.getPreviousError(t)) ? $(l).offset().top : 0) + (l ? $(l).outerHeight() : 0))) < 0 && (a = a + -1 * d + 5), h = this._getOffsetLeft(i.left, u.left, r, m, f), 0 !== a && (a = parseInt(t.css("marginTop"), 10) < 0 ? parseInt(t.css("marginTop"), 10) + a : a, t.css("marginTop", a)), 0 !== h && -1 !== h && t.css({
                    marginLeft: h
                })
            }
        },
        _getOffsetLeft: function(t, o, s, i, r) {
            var e = t + "" + o + s;
            return void 0 !== this.offsetLefts[e] || (this.offsetLefts[e] = r ? -1 * i - this.options.distanceError : parseInt(t, 10) + parseInt(s, 10) + this.options.distanceError), this.offsetLefts[e]
        },
        _getOffsetTop: function(t, o, s, i) {
            var r = t + "" + o + s + i;
            return void 0 !== this.offsetTops[r] || (this.offsetTops[r] = t - o - Math.ceil(parseInt(s, 10) / 2) + Math.ceil(parseInt(i, 10) / 2)), this.offsetTops[r]
        },
        getPreviousError: function(s) {
            var t = this.validateObject.errors(),
                i = !1,
                r = !1;
            return s = s.find(".error")[0], $.forEach(t, function(t, o) {
                i || (i = t === s), i || (r = t)
            }), "string" != typeof r && r
        },
        reCheck: function(t) {
            if (t.success) return !0;
            if (t.error) {
                if (void 0 !== t.error.formFields) {
                    var o = t.error.formFields,
                        s = [];
                    $.forEach(o, function(t, o) {
                        s[o] = t.text
                    }), this.validateObject.showErrors(s)
                }
                return void 0 !== t.error.message ? $.dispatch("ERRORNOTIFICATION", {
                    message: t.error.message
                }) : $.dispatch("ERRORNOTIFICATION", {
                    message: i("js.common_for_all.error_occured")
                }), !1
            }
            $.dispatch("ERRORNOTIFICATION", {
                message: i("js.common_for_all.error_occured")
            })
        },
        addRules: function(t) {
            var s;
            $.forEach(t, function(t, o) {
                s = o.substr(0, 1), o.match(/^[A-Za-z]*$/) && s.toUpperCase() == s && (o = "#" + o), $(o).rules("add", t), $(o).attr("name") || $.console.log("Error! (name field missing for " + o + ")")
            })
        },
        onfocusout: function(t) {
            $(t).removeClass("valid"), this.checkable(t) || !(t.name in this.submitted) && this.optional(t) || this.element(t)
        }
    })
}(ustream.framework.i18n._t_);
ustream.classes.Validator2 = ustream.classes.Validator.extend({
    options: {
        onErrorPlacement: !1,
        valignBubbles: !0
    },
    errorMessagePosition: function(o, t) {
        this.options.onErrorPlacement ? "function" == typeof this.options.onErrorPlacement && this.options.onErrorPlacement(o, t) : this.options.valignBubbles && o.css({
            marginTop: -1 * o.height() / 2
        })
    },
    _getOffsetLeft: function() {},
    _getOffsetTop: function() {},
    getPreviousError: function() {}
});
! function(t) {
    ustream.classes.PasswordIndicator = $.klass({
        options: {
            template: '<div class="uError uInfo"><label></label></div>',
            v3template: '<div class="uError uInfo"><b class="arrow"></b><b class="subArrow"></b><label></label></div>',
            position: "right",
            distance: 20,
            version: ""
        },
        shown: !1,
        states: [{
            label: t("js.v6.validator_info.password_low")
        }, {
            label: t("js.v6.validator_info.password_medium"),
            regexp: /(?=.{8,})/
        }, {
            label: t("js.v6.validator_info.password_high"),
            regexp: /(?=.+[,.?:)(/'"+§!@#$%^&*-])(?=.{8,})/
        }],
        initialize: function(t) {
            $.extend(this.options, t || {}), this.form = $(this.options.form), this.pwField = this.form.find(this.options.field), this.attachHandler()
        },
        attachHandler: function() {
            this.pwField.blur($.proxy(this.onBlur, this)).focus($.proxy(this.hideIndicator, this))
        },
        onBlur: function() {
            var t = this.pwField.hasClass("error");
            t || "" === this.pwField.val() ? t && this.shown && this.hideIndicator() : this.shown ? this.checkStrength() : this.showIndicator()
        },
        showIndicator: function() {
            this.pwField.siblings(".uInfo").length ? this.indicator.show() : (this.indicator = $(this.options[this.options.version + "template"]), this.pwField.after(this.indicator)), this.checkStrength(), this.shown = !0
        },
        hideIndicator: function() {
            this.shown && (this.indicator.hide(), this.shown = !1)
        },
        checkStrength: function() {
            for (var t, i = this.pwField.val(), s = this.states, o = 0, e = s.length, n = s[0].label; o < e; o++)(t = s[o]).regexp && t.regexp.test(i) && (n = t.label);
            this.indicator.css({
                marginTop: "auto",
                marginLeft: "auto"
            }).find("label").text(n), this.setPosition()
        },
        setPosition: function() {
            var t, i, s = this.pwField,
                o = this.indicator,
                e = s.offset(),
                n = s.outerHeight(),
                a = o.offset(),
                h = o.outerHeight();
            "right" === this.options.position && (t = e.top - a.top - Math.ceil(parseInt(h, 10) / 2) + Math.ceil(parseInt(n, 10) / 2), i = s.outerWidth() + s[0].offsetLeft + this.options.distance, this.indicator.css({
                marginTop: t,
                marginLeft: i
            }))
        }
    })
}(ustream.framework.i18n._t_);
ustream.templates.tosDialog = '<% var l = T.labels || {}, text, checkboxId %><div title="<%= l.title %>"><div class="ui-dialog-body simpletxt"><% if (l.intro) { %><div class="intro"><%= l.intro %></div><% } %><div class="mainContent"><% for (text in l.content) { %><div><%= l.content[text] %></div><% } %></div><% if (l.checkbox) { %><% checkboxId = "Accept" + T.id %><input type="checkbox" id="<%= checkboxId %>"/><label for="<%= checkboxId %>"><%= l.checkbox %></label><% } %><% if (l.checkbox2) { %><br /><% checkboxId = "Accept" + T.id + "2"%><input type="checkbox" id="<%= checkboxId %>"/><label for="<%= checkboxId %>"><%= l.checkbox2 %></label><% } %><% if (l.checkbox3) { %><br /><% checkboxId = "Accept" + T.id + "3"%><input type="checkbox" id="<%= checkboxId %>"/><label for="<%= checkboxId %>"><%= l.checkbox3 %></label><% } %><% if (l.notes) { %><div class="notes"><%= l.notes %></div><% } %></div><div class="ui-dialog-footer"><a class="cancel" ><%= _t_("js.v3.tos_common.cancel") %></a><a class="button<%= (l.checkbox) ? " disabled" : "" %> submit"><span><%= _t_("js.v3.tos_common.submit") %></span></a></div></div>';
define("classes/Tos", ["events", "coverLayer", "dialog", "klass", "lodash", "exposedVars"], function(i, t, a, s, o, h) {
    return s({
        template: ustream.templates.tosDialog,
        options: {
            id: ""
        },
        __mixin: [t],
        initialize: function(t) {
            this.options = o.merge(this.options, t || {}), this.getTos(), this.createDialog(), this.addListeners()
        },
        getTos: function() {
            this.tos = h.get("tos")[this.options.id], this.tos.id = this.options.id
        },
        adjustHeight: function() {
            var t, i = $(window).height(),
                s = this.dialog.parent(),
                o = s.find(".mainContent"),
                e = o.height();
            i <= (t = $(document.body).hasClass("v3") ? s.find(".ui-dialog-content > div").innerHeight() + s.find(".ui-dialog-title").innerHeight() : s.innerHeight()) && o.height(e - (t - i))
        },
        createDialog: function() {
            var t, i, s = new ustream.classes.SimpleTpl(this.template),
                o = $(s.run(this.tos)),
                e = h.get("isIframe"),
                n = {
                    dialogClass: "tosDialog " + this.options.id,
                    modal: !0,
                    draggable: !1,
                    closeOnEscape: !1,
                    resizable: !1,
                    zIndex: 1e3,
                    width: 570,
                    height: "auto",
                    maxHeight: 568
                };
            e && (t = $(window), i = $(window).height(), $.extend(n, {
                width: t.width(),
                height: i,
                maxHeight: i
            })), this.dialog = a(o, n), this.adjustHeight()
        },
        addListeners: function() {
            this.checkboxes = $("input:checkbox", this.dialog), this.checkboxes && this.checkboxes.click($.proxy(this.onCheck, this)), this.submitButton = $(".submit", this.dialog), this.cancelButton = $(".cancel", this.dialog), this.submitButton.click($.proxy(this.onSubmit, this)), this.cancelButton.click($.proxy(this.onCancel, this))
        },
        onCheck: function(t) {
            var s = !0;
            $.each(this.checkboxes, function(t, i) {
                $(i).prop("checked") || (s = !1)
            }), s ? this.submitButton.removeClass("disabled") : this.submitButton.addClass("disabled")
        },
        onSubmit: function(t) {
            t && (t.preventDefault(), t.stopPropagation());
            var i = this;
            this.submitButton.hasClass("disabled") || (this.cover(this.dialog), require(["datasources/AjaxDataSource"], function(t) {
                t.getInstance().request({
                    url: i.tos.urls.accept,
                    method: "POST",
                    dataType: "json",
                    xhrFields: {
                        withCredentials: !0
                    },
                    success: $.proxy(i.onAcceptResponse, i),
                    error: $.proxy(i.onAcceptResponse, i)
                })
            }))
        },
        onAcceptResponse: function(t) {
            this.uncover(), t.success ? i.dispatch("TOSACCEPTED", {
                tosId: this.options.id
            }) : (i.dispatch("TOSCANCELLED", {
                tosId: this.options.id
            }), i.dispatch("AJAXNOTIFICATION", {
                response: t
            }))
        },
        onCancel: function(t) {
            this.cover(this.dialog), $.cookie("fbal", 1, {
                path: "/"
            });
            try {
                window.top && window.top.ustream ? window.top.location = "/logout?ref=" + window.top.ustream.vars.pageUrl : window.location = "/logout?ref=" + h.get("pageUrl")
            } catch (t) {
                window.location = "/logout?ref=" + h.get("pageUrl")
            }
        },
        close: function() {
            a(this.dialog, "destroy")
        },
        getTosId: function() {
            return this.options.id
        }
    })
});
define("classes/TosManager", ["classes/Authentication/LoggedInDataSyncer", "classes/Tos", "events", "klass", "exposedVars"], function(s, t, o, e, i) {
    return e({
        useObjectPool: !0,
        queue: [],
        tosInstances: {},
        initialize: function() {
            i.get("loggedIn") && this.setup()
        },
        setup: function() {
            var e, s = i.get("tos");
            if (s) {
                for (e in s) s.hasOwnProperty(e) && this.queue.push(e);
                this.queue.length ? (o.capture("TOSACCEPTED", $.proxy(this.onTosAccepted, this)), o.capture("TOSCANCELLED", $.proxy(this.onTosAccepted, this)), this.openNextTos()) : o.dispatch("ALLTOSACCEPTED")
            } else o.dispatch("ALLTOSACCEPTED")
        },
        initTos: function(e) {
            var s;
            switch (e) {
                case "master_ui":
                case "master_ua":
                    s = new t({
                        id: e
                    });
                    break;
                default:
                    return
            }
            this.tos = s
        },
        openNextTos: function() {
            var e = this.queue[0];
            e ? this.initTos(e) : o.dispatch("ALLTOSACCEPTED")
        },
        onTosAccepted: function() {
            this.closeTos(), this.openNextTos()
        },
        closeTos: function() {
            var e = this.queue[0];
            this.tos.close(), this.tos = null, delete this.tos, i.get("tos")[e] = null, delete i.get("tos")[e], this.queue.shift(), s.clear()
        }
    })
});
ustream.templates.proBroadcasterWarning = '<div><input type="hidden" data-template="proBroadcasterWarning" /><div class="ui-dialog-body"><%= content %></div><div class="ui-dialog-footer"><% if (labels.close) { %><a class="close"><%= labels.close %></a><% } %><a href="<%= dashboardUrl %>" class="button"><span><%= labels.goToDashboard %></span></a></div></div>';
! function(t, e, a) {
    a.classes.ProBroadcasterWarning = $.klass({
        template: a.templates.proBroadcasterWarning,
        popupData: {
            warn: {
                content: null,
                title: "Payment overdue",
                button1text: "Go to Dashboard",
                button2text: t("js.adfree_warning.btn_close")
            },
            suspend: {
                title: "Subscription terminated",
                content: null,
                button1text: "Go to Dashboard"
            }
        },
        initialize: function(t) {
            var e, n, o;
            t = t || {}, a.vars.subscriptionSuspended && (n = "suspend"), a.vars.subscriptionWarned && (n = "warn"), n && ((o = this.popupData[n]).content = a.vars.adfreeWarningContent, o.content || $.console.log("no adfreeWarningContent"), this.template = new a.classes.SimpleTpl(this.template), e = $(this.template.run({
                content: o.content,
                dashboardUrl: "/ustream-pro/overview",
                labels: {
                    goToDashboard: o.button1text,
                    close: !!o.button2text && o.button2text
                }
            })), this.dialog = e.dialog({
                modal: !0,
                title: o.title,
                autoOpen: !0,
                width: 440,
                minHeight: 60,
                dialogClass: "proBroadcasterWarning",
                close: t.onClose || function() {}
            }), e.find(".close").click($.proxy(function() {
                this.dialog.dialog("close")
            }, this)))
        }
    })
}(window.ustream.framework.i18n._t_, window.ustream.framework.stringUtils, window.ustream);
ustream.templates.emailConfirmDialog = '<div id="EmailConfirmDialog"><input type="hidden" data-template="emailConfirmDialog" /><div class="ui-dialog-body"><p><%= labels.emailConfirmText %></p></div><div class="ui-dialog-footer"><a class="button"><%= labels.continueButton %></a></div></div>';
! function(i, t) {
    t.classes.EmailConfirmDialog = $.klass({
        options: {
            callback: function() {}
        },
        template: t.templates.emailConfirmDialog,
        initialize: function(i) {
            this.options = $.klass.merge(this.options, i || {}), t.vars.newClassicSignUp ? t.vars.skipEmailConfirmDialog || ($.capture("FACEBOOKCONNECTED", $.proxy(this.onClose, this)), this.show()) : this.options.callback()
        },
        show: function() {
            this.panel || this.initPanel(), this.panel.dialog("open")
        },
        initPanel: function() {
            this.template = new t.classes.SimpleTpl(this.template), this.panel = $(this.template.run({
                labels: {
                    emailConfirmText: i("js.experience.email_confirm_dialog.text_1"),
                    continueButton: i("js.experience.email_confirm_dialog.continue_button")
                }
            })), this.panel.find(".ui-dialog-footer a.button").click($.proxy(this.onClose, this)), this.panel.dialog({
                title: i("js.experience.email_confirm_dialog.title_1"),
                modal: !0,
                autoOpen: !1,
                maxWidth: 444,
                fixed: !1,
                close: $.proxy(this.onPanelClose, this)
            })
        },
        onClose: function() {
            this.panel && this.panel.dialog("close")
        },
        onPanelClose: function() {
            this.options.callback()
        }
    })
}(window.ustream.framework.i18n._t_, window.ustream);
ustream.templates.facebookConnectDialog = '<div id="FacebookConnectDialog"><input type="hidden" data-template="FacebookConnectDialog" /><div class="ui-dialog-body"><p><%= labels.text %></p><div class="fbButtonWrapper"><a class="facebookSignIn"><span></span><%= labels.connectToFacebook %></a></div></div><div class="ui-dialog-footer"><a><%= labels.noThanks %></a></div></div>';
define("classes/FacebookConnectDialog", ["events", "dialog", "i18n", "klass", "lodash", "exposedVars"], function(o, e, n, t, i, s) {
    return t({
        _singleton: !0,
        options: {
            callback: function() {}
        },
        template: ustream.templates.facebookConnectDialog,
        initialize: function(e) {
            this.options = i.merge(this.options, e || {}), s.get("showFacebookConnectDialog") ? (o.capture("FACEBOOKCONNECTED", $.proxy(this.onClose, this)), this.show()) : this.options.callback()
        },
        show: function() {
            this.panel || this.initPanel(), e(this.panel, "open")
        },
        initPanel: function() {
            this.template = new ustream.classes.SimpleTpl(this.template), this.panel = $(this.template.run({
                labels: {
                    text: n("js.experience.facebook_connect_dialog.text"),
                    connectToFacebook: n("js.experience.facebook_connect_dialog.connect"),
                    noThanks: n("js.experience.facebook_connect_dialog.no_thanks")
                }
            })), this.panel.find(".facebookSignIn").click($.proxy(this.onFacebookConnectClick, this)), this.panel.find(".ui-dialog-footer a").click($.proxy(this.onClose, this)), e(this.panel, {
                title: n("js.experience.facebook_connect_dialog.title"),
                modal: !0,
                resizable: !1,
                draggable: !1,
                autoOpen: !1,
                width: 440,
                fixed: !1,
                close: $.proxy(this.onPanelClose, this)
            })
        },
        onFacebookConnectClick: function() {
            o.dispatch("FACEBOOKCONNECT", {
                openerId: "fullconnectexperience"
            })
        },
        onClose: function() {
            this.panel && e(this.panel, "close")
        }
    })
});
define("classes/Recaptcha", ["events", "i18n", "klass", "lodash"], function(t, a, i, s) {
    window.ustream;
    return i({
        recaptchaOptions: {},
        options: {
            ajaxLibUrl: "https://www.google.com/recaptcha/api.js?render=explicit",
            wrapId: "RecaptchaContainer"
        },
        initialize: function(t) {
            this.options = s.merge(this.options, t || {}), t && (this.recaptchaOptions = t.recaptchaOptions || {}), this.recaptchaOptions.wrapId && (this.options.wrapId = t.recaptchaOptions.wrapId)
        },
        init: function() {
            $("#" + this.options.wrapId).length && this.set()
        },
        create: function() {
            var t = $("#" + this.options.wrapId);
            this.recaptchaOptions.sitekey = t.data("sitekey"), this.recaptchaOptions.stoken = t.data("stoken"), this.recaptchaId = window.grecaptcha.render(this.options.wrapId, this.recaptchaOptions)
        },
        reload: function() {
            window.grecaptcha.reset(this.recaptchaId)
        },
        set: function() {
            $("#" + this.options.wrapId).length && (window.grecaptcha ? void 0 !== this.recaptchaId ? this.reload() : this.create() : this.getLib())
        },
        ajaxLibLoaded: !1,
        getLib: function() {
            var t = "u_onRecapthcaLoad_" + Math.floor(1e3 * Math.random()),
                a = $("<script><\/script>");
            window[t] = $.proxy(this.checkStatus, this), this.statusIterator = 0, a.attr("src", this.options.ajaxLibUrl + "&onload=" + t), a.attr("type", "text/javascript"), $("body").append(a)
        },
        statusIterator: 0,
        checkStatus: function() {
            if (window.grecaptcha) this.set();
            else {
                if (this.statusIterator = this.statusIterator + 1, 20 < this.statusIterator) return t.dispatch("ERRORNOTIFICATION", {
                    message: a("js.experience.login_dialogs.common_error"),
                    sticky: !0,
                    clearQueue: !0
                }), void(this.statusIterator = 0);
                setTimeout($.proxy(this.checkStatus, this), 200)
            }
        }
    })
});
define("classes/CustomPasswordHandler", ["klass", "lodash"], function(t, s) {
    return t({
        options: {
            delegate: "body",
            selector: ".custom-password-group"
        },
        initialize: function(t) {
            this.options = s.merge(this.options, t), $(this.options.delegate).on("click", this.options.selector + " button", $.proxy(this.switchInputs, this))
        },
        switchInputs: function(t) {
            var s = $(t.target).closest(this.options.selector),
                o = s.find("input"),
                e = $("<input>");
            $.each(o[0].attributes, function(t, s) {
                "type" !== s.name && e.attr(s.name, s.value)
            }), e.attr("type", "password" === o.attr("type") ? "text" : "password").val(o.val()), o.replaceWith(e), s.toggleClass("show-password"), e.focus()
        }
    })
});
define("classes/CustomPasswordIndicator", ["i18n", "klass", "lodash"], function(i, t, o) {
    return t({
        options: {
            delegate: "body",
            selector: ".custom-password-group input",
            tooltipString: i("js.login.password_tooltip")
        },
        initialize: function(i) {
            this.options = o.merge(this.options, i), this.bindIndicator()
        },
        bindIndicator: function() {
            this.options.binded || ($(this.options.delegate).on("focus keyup", this.options.selector, $.proxy(this.onKeyup, this)), this.options.binded = !0)
        },
        unbindIndicator: function() {
            $(this.options.delegate).off("focus keyup", this.options.selector), this.options.binded = !1
        },
        onKeyup: function(i) {
            var t = $(i.target);
            0 === t.val().length ? this.insertIndicator(t) : this.hideIndicator(t)
        },
        hideIndicator: function(i) {
            i.siblings(".password-info").hide()
        },
        insertIndicator: function(i) {
            i.siblings(".password-info").length || i.hasClass("input-invalid") || i.parent().append(this.getTooltipTemplate())
        },
        getTooltipTemplate: function() {
            return '<span class="password-info tooltip-info valid"><span>' + this.options.tooltipString + "</span></span>"
        }
    })
});
define("classes/PostLoginOverlayManager", ["classes/FacebookConnectDialog", "events", "klass", "lodash", "exposedVars"], function(i, o, a, n, s) {
    return a({
        options: {
            callback: function() {}
        },
        tosCaptured: !1,
        initialize: function(i) {
            this.options = n.merge(this.options, i || {}), this.setupDialogDisable()
        },
        start: function() {
            this.initEmailConfirmDialog()
        },
        initEmailConfirmDialog: function() {
            this.disabledDialogs.emailConfirm ? this.initFacebookConnectDialog() : new ustream.classes.EmailConfirmDialog({
                callback: $.proxy(this.initFacebookConnectDialog, this)
            })
        },
        initFacebookConnectDialog: function() {
            this.disabledDialogs.facebookConnect ? this.initProBroadcasterWarning() : new i({
                callback: $.proxy(this.initProBroadcasterWarning, this)
            })
        },
        initProBroadcasterWarning: function() {
            !s.get("subscriptionSuspended") && !s.get("subscriptionWarned") || this.disabledDialogs.proBroadcasterWarning ? this.finish() : new ustream.classes.ProBroadcasterWarning({
                onClose: $.proxy(this.finish, this)
            })
        },
        finish: function() {
            this.options.callback()
        },
        setupDialogDisable: function() {
            this.disabledDialogs = {
                emailConfirm: !1,
                facebookConnect: !1,
                proBroadcasterWarning: !1,
                tos: !1
            }, o.capture("DISABLEPOSTLOGINDIALOGS", $.proxy(function(i) {
                var o = i.eventData,
                    a = this.disabledDialogs;
                o && (o.emailConfirm && (a.emailConfirm = !0), o.facebookConnect && (a.facebookConnect = !0), o.proBroadcasterWarning && (a.proBroadcasterWarning = !0), o.tos && (a.tos = !0))
            }, this)), o.capture("ENABLEPOSTLOGINDIALOGS", $.proxy(function() {
                var i = this.disabledDialogs;
                i.emailConfirm = !1, i.facebookConnect = !1, i.proBroadcasterWarning = !1, i.tos = !1
            }, this))
        }
    })
});
define("classes/FacebookLoginStatus", ["events", "klass", "exposedVars"], function(e, s, t) {
    return s({
        facebookAppId: t.get("facebookAppId"),
        loading: !1,
        accessToken: null,
        permissions: [],
        initialize: function() {
            e.capture("FACEBOOKCONNECTED", $.proxy(this.refreshLoginStatus, this)), e.capture("FACEBOOKDISCONNECTED", $.proxy(this.refreshLoginStatus, this)), e.capture("FACEBOOKSETPOSTPERMISSION", $.proxy(this.refreshLoginStatus, this)), this.refreshLoginStatus()
        },
        refreshLoginStatus: function() {
            this.loading || (this.loading = !0, window.FB.getLoginStatus($.proxy(this.onGetLoginStatusResponse, this), !0))
        },
        onGetLoginStatusResponse: function(s) {
            void 0 !== s && (s.authResponse || s.session) ? (this.setAccessToken(s), this.getPermissions(s)) : (e.dispatch("FACEBOOKLOGINSTATUSRESPONSE", {
                connected: !1
            }), this.loading = !1)
        },
        setAccessToken: function(s) {
            s.session && s.session.access_token ? this.accessToken = s.session.access_token : s.authResponse && s.authResponse.accessToken && (this.accessToken = s.authResponse.accessToken)
        },
        getPermissions: function() {
            window.FB.api("/me/permissions", $.proxy(this.onPermStatusResponse, this))
        },
        onPermStatusResponse: function(s) {
            void 0 !== s && s.data && s.data[0] ? (this.permissions = s.data[0], e.dispatch("FACEBOOKLOGINSTATUSRESPONSE", {
                connected: !0,
                accessToken: this.accessToken,
                permissions: this.permissions
            })) : e.dispatch("FACEBOOKLOGINSTATUSRESPONSE", {
                connected: !0,
                accessToken: this.accessToken,
                permissions: []
            }), this.loading = !1
        }
    })
});
! function(a, n, r, l) {
    define("classes/FacebookAutoLogin", ["datasources/AjaxDataSource", "events", "ustream-centrallogging", "jsdebug", "lodash"], function(i, s, e, t, o) {
        return $.klass({
            _disabledCookie: "fbal",
            _turnedOffCookie: "fbalto",
            _allowedByPercentageStorageId: "session.facebookAutoLogin.allowedByPercentage",
            _turnedOffLocalStorageId: "local.facebookAutoLogin.turnedOff",
            initialize: function() {
                this.drawAllowByPercentage(), e && (this.logger = e.create({
                    subdomain: "eventtracking-log",
                    tag: "eventtracking.dashboard",
                    type: "web",
                    callback: function(e, s) {
                        if (e) throw e;
                        t("sent log payloads", s)
                    }
                })), l.storage.available ? n(this._turnedOffLocalStorageId) : $.cookie(this._turnedOffCookie, null, {
                    path: "/"
                }), s.capture("DISABLEFACEBOOKAUTOLOGIN", $.proxy(this.setDisabled, this)), s.capture("FACEBOOKCONNECTED", $.proxy(this.enableAutoLogin, this)), l.vars.loggedIn || this.isDisabled() || s.capture("FACEBOOKLOGINSTATUSRESPONSE", $.proxy(this.initAutoLogin, this))
            },
            initAutoLogin: function(e) {
                var s, t = e.eventData,
                    o = l.vars.pageUrl;
                if (l.state && l.state.path && (o = l.state.path), s = l.vars.fbAutoLoginUrl + "?pageUrl=" + o, l.vars.channelId && (s += "&channelId=" + l.vars.channelId), !l.vars.loggedIn)
                    if (t.connected && t.accessToken) {
                        if (this.isAllowedByPercentage() && this.hasAllPermisions(t.permissions)) {
                            var a = {
                                product: "facebook-autologin",
                                loggedIn: l.vars.loggedIn,
                                opener: t.opener,
                                success: t.success,
                                isAllowedByPercentage: this.isAllowedByPercentage(),
                                hasAllPermisions: this.hasAllPermisions(t.permissions),
                                requestUrl: s,
                                isDisabled: this.isDisabled()
                            };
                            this.logger && this.logger.send([{
                                data: a
                            }]), !this.isDisabled() && l.vars.fbAutoLoginUrl && i.getInstance().request({
                                type: "POST",
                                url: s,
                                xhrFields: {
                                    withCredentials: !0
                                },
                                data: {
                                    pageUrl: o,
                                    access_token: t.accessToken,
                                    rw: ""
                                },
                                success: $.proxy(this.onLoginResponse, this)
                            })
                        }
                    } else this.setDisabled()
            },
            onLoginResponse: function(e) {
                e.success ? s.dispatch("LOGINREQUESTWITHRESPONSEDATA", e) : this.setDisabled()
            },
            enableAutoLogin: function() {
                $.cookie(this._disabledCookie, null, {
                    path: "/"
                })
            },
            setDisabled: function() {
                $.cookie(this._disabledCookie, 1, {
                    path: "/"
                })
            },
            isDisabled: function() {
                return !!$.cookie(this._disabledCookie)
            },
            drawAllowByPercentage: function() {
                var e, s = Math.random();
                a(this._allowedByPercentageStorageId).success || (e = s <= l.vars.fbAutoLoginProbability / 100 ? 1 : 0, r(this._allowedByPercentageStorageId, e))
            },
            isAllowedByPercentage: function() {
                return !!a(this._allowedByPercentageStorageId).success && 1 === a(this._allowedByPercentageStorageId).value
            },
            hasAllPermisions: function(e) {
                if (!l.vars.fbRequiredPermissions) return !1;
                var s, t, o = l.vars.fbRequiredPermissions,
                    a = o.length;
                for (s = 0; s < a; s += 1)
                    if (!e[t = o[s]] || 1 !== e[t]) return !1;
                return !0
            }
        })
    })
}(window.ustream.storage.get, window.ustream.storage.remove, window.ustream.storage.set, window.ustream);
define("models/Features", ["abstracts/Model"], function(e) {
    return e.extend({
        _singleton: !0,
        register: function(e) {
            this.set(e, !0)
        },
        has: function(e) {
            return Boolean(this.get(e))
        }
    })
});
define("models/CurrentUserModel", ["abstracts/Model", "events"], function(t, e) {
    return t.extend({
        _singleton: !0,
        initialize: function() {
            this.parent(ustream.vars), e.capture("MANAGERSMADEACTIVE", $.proxy(this.onManagersActivated, this)), e.capture("MANAGERSMADEINACTIVE", $.proxy(this.onManagersInactivated, this))
        },
        updateData: function() {
            this.data = ustream.vars
        },
        isLoggedIn: function() {
            return this.get("loggedIn")
        },
        isProBroadcaster: function() {
            return this.isLoggedIn() && Boolean(this.get("isProUser"))
        },
        canAddManager: function() {
            return this.canAddManagers(1)
        },
        canAddManagers: function(t) {
            return +this.get("activeManagerCount") + t <= +this.get("managerCountLimit")
        },
        onManagersActivated: function(t) {
            var e = +t.eventData;
            if (isNaN(e) || e !== parseInt(e, 10)) throw new TypeError("CurrentUserModel: Number of activated managers must be an integer");
            this.set("activeManagerCount", +this.get("activeManagerCount") + e)
        },
        onManagersInactivated: function(t) {
            var e = +t.eventData;
            if (isNaN(e) || e !== parseInt(e, 10)) throw new TypeError("CurrentUserModel: Number of inactivated managers must be an integer");
            this.set("activeManagerCount", +this.get("activeManagerCount") - e)
        },
        isTrialUser: function() {
            return this.isLoggedIn() && Boolean(this.get("isTrialUser"))
        }
    })
});
define("models/AuthenticationModel", ["abstracts/Model", "stringUtils", "datasources/AjaxDataSource", "exposedVars"], function(e, t, r, s) {
    return e.extend({
        _singleton: !0,
        initialize: function() {
            this.dataSource = r.getInstance()
        },
        getLoggedInDataUrl: function() {
            return t.urlSubst(s.get("contentUrls").user, {
                type: s.get("contentType") || "channel",
                id: s.get("contentId") || 0
            })
        },
        isPopup: function() {
            return window.opener !== window && $(window).width() < 717
        },
        getAuthUrl: function(e) {
            var t, r = document.createElement("a");
            return r.href = e, r.protocol = "https:", (t = this.getPageUrl()) && (r.href += "?pageUrl=" + t), r.href
        },
        getLoginUrl: function() {
            return this.getAuthUrl(s.get("loginUrl"))
        },
        getSignupUrl: function() {
            return this.getAuthUrl(s.get("simpleSignupUrl"))
        },
        getRefUrl: function(e) {
            var t, r, s, n, a = "";
            for (r = 0, s = (t = e.search.split("&")).length; r < s; r += 1) - 1 < t[r].indexOf("ref=") && (n = t[r].split("=")[1]);
            return n && ((n = decodeURIComponent(n)).match(/^\//) || n.match(/^\/[^/].*/)) && (a = n), a
        },
        getPageUrl: function() {
            return ustream.state && ustream.state.path ? ustream.state.path : s.get("pageUrl")
        },
        extendLoginData: function(e) {
            return e.refUrl = this.getRefUrl(location), e
        },
        getOnResponseCallback: function(t, r) {
            return function(e) {
                e && e.success ? t(e) : r(e)
            }
        },
        loginUser: function(e, t, r) {
            e = e || {}, this.dataSource.request({
                type: "post",
                url: this.getLoginUrl(),
                data: this.extendLoginData(e),
                xhrFields: {
                    withCredentials: !0
                },
                success: this.getOnResponseCallback(t, r),
                error: r
            })
        },
        signupUser: function(e, t, r) {
            this.dataSource.request({
                type: "post",
                url: this.getSignupUrl(),
                data: e,
                xhrFields: {
                    withCredentials: !0
                },
                success: this.getOnResponseCallback(t, r),
                error: r
            })
        },
        getRequiredAgreements: function(e, t) {
            var r = s.get("signupRequiredAgreementsUrl");
            this.dataSource.request({
                url: r,
                xhrFields: {
                    withCredentials: !0
                },
                success: this.getOnResponseCallback(e, t),
                error: t
            })
        },
        getForgotPasswordOverlay: function(e, t) {
            var r = s.get("forgotPasswordOverlayUrl");
            this.dataSource.request({
                url: r,
                xhrFields: {
                    withCredentials: !0
                },
                success: this.getOnResponseCallback(e, t),
                error: t
            })
        },
        getLoggedInData: function(e, t) {
            this.dataSource.request({
                url: this.getLoggedInDataUrl(),
                xhrFields: {
                    withCredentials: !0
                },
                success: this.getOnResponseCallback(e, t),
                error: t
            })
        },
        requestPasswordReset: function(e, t, r) {
            this.dataSource.request({
                url: this.forgotPassowrdUrl,
                xhrFields: {
                    withCredentials: !0
                },
                type: "post",
                data: e,
                success: this.getOnResponseCallback(t, r),
                error: r
            })
        },
        resetPassword: function(e, t, r) {
            this.dataSource.request({
                url: this.resetPasswordUrl,
                xhrFields: {
                    withCredentials: !0
                },
                type: "post",
                data: e,
                success: this.getOnResponseCallback(t, r),
                error: r
            })
        }
    })
});
define("models/StandaloneAuthenticationModel", ["models/AuthenticationModel"], function(n) {
    return n.extend({
        _singleton: !0,
        loginUser: function() {}
    })
});
define("classes/DialogForm/View", ["abstracts/View", "events", "coverLayer", "dialog", "uvalidator"], function(i, t, o, n, a) {
    var e, s;
    return s = {
        EVENT_RESPONSE_ERROR: "responseError",
        EVENT_DIALOG_CLOSED: "dialogClosed",
        EVENT_DIALOG_OPENED: "dialogOpened"
    }, (e = i.extend({
        __mixin: [o],
        dialogOptions: {
            modal: !0,
            resizable: !1,
            draggable: !1,
            autoOpen: !1,
            focusOnFirstInput: !1
        },
        container: "<div></div>",
        template: null,
        dialogTemplateOptions: {},
        validatorConf: {
            validationEvents: {
                submit: !0,
                blur: !0
            }
        },
        load: function() {
            this.cover(this.container)
        },
        noLoad: function() {
            this.uncover()
        },
        onFormValid: null,
        onFormInvalid: null,
        onFieldInvalid: null,
        setupValidator: function() {
            var i = a.events;
            this.validator = a.applySkin("ustream", this.form, this.validatorConf), this.validator.on(i.FORM_VALID, $.proxy(this.onFormValid, this)), this.validator.on(i.FORM_INVALID, $.proxy(this.onFormInvalid, this)), this.validator.on(i.FIELD_INVALID, $.proxy(this.onFieldInvalid, this))
        },
        createDialogFromTemplate: function() {
            var i;
            i = new ustream.classes.SimpleTpl(this.template).run(this.dialogTemplateOptions), this.container.html(i)
        },
        createDialog: function() {
            this.hasDialog || (this.template && this.createDialogFromTemplate(), this.dialogOptions.close = $.proxy(this.onDialogClose, this), this.dialogOptions.open = $.proxy(this.onDialogOpen, this), n(this.container, this.dialogOptions), this.form = this.container.find("form"), this.hasDialog = !0, this.setupValidator(), t.dispatch("RESETPLACEHOLDERS"))
        },
        open: function() {
            this.createDialog(), t.dispatch("CLEARLASTNOTIFICATION"), n(this.container, "open"), this.isDialogOpened = !0
        },
        setDialogTitle: function(i) {
            this.dialogOptions.title = i, this.hasDialog && n(this.container, "options", "title", i)
        },
        close: function() {
            this.container && n(this.container, "close")
        },
        showFormErrors: function() {
            this.emit(s.EVENT_RESPONSE_ERROR)
        },
        isDialogOpened: !1,
        onDialogClose: function(i) {
            this.emit(s.EVENT_DIALOG_CLOSED, i), this.isDialogOpened = !1
        },
        onDialogOpen: function(i) {
            this.emit(s.EVENT_DIALOG_OPENED, i)
        },
        clearFields: function() {
            this.container.find(":input").each($.proxy(function(i, t) {
                this.validator && this.validator.unsetValidatorState(t)
            }, this)).filter("input[type=text], input[type=password]").val("")
        }
    })).events = s, e
});
window.ustream, define("classes/DialogForm/Controller", ["abstracts/Controller", "events"], function(i, n) {
    return i.extend({
        viewEvents: {
            dialogClosed: "onDialogClosed"
        },
        initialize: function(i, e, t) {
            this.view = i, this.model = e, this.tracker = t, n.capture("USERAUTHENTICATED", $.proxy(function() {
                this.view.close()
            }, this)), this.parent()
        },
        getStartGaTriggerLabel: function(i) {
            var e = null;
            return i && i.gaTriggerLabel && (e = i.gaTriggerLabel), e
        },
        isAlign: !1,
        isPro: !1,
        planId: null,
        start: function(i) {
            this.isAlign = i && i.align, this.isPro = i && i.pro, this.planId = i && i.planId, this.tracker.open(this.getStartGaTriggerLabel(i))
        },
        onDialogOpen: function() {
            this.view.clearFields()
        },
        onDialogClosed: function(i) {
            if (this.view.clearFields(), n.dispatch("CLEARLASTNOTIFICATION"), n.dispatch("LOGINDIALOGCLOSED", this), i && i.originalEvent) {
                var e = i.originalEvent;
                27 === e.keyCode ? this.tracker.closeEscPressed() : "click" === e.type && this.tracker.closeButton()
            }
        }
    })
});
define("classes/Signup/View", ["classes/DialogForm/View", "classes/Recaptcha", "classes/CustomPasswordHandler", "classes/CustomPasswordIndicator", "lodash", "uvalidator", "i18n"], function(i, e, a, s, t, n, o) {
    var r;
    return (r = i.extend({
        dialogTemplateOptions: {
            labels: {
                signUpText: o("js.experience.signup_dialog.text"),
                email: o("js.experience.signup_dialog.email"),
                username: o("js.experience.signup_dialog.username"),
                password: o("js.experience.signup_dialog.password"),
                passwordVerify: o("js.experience.signup_dialog.retype_password"),
                agree: o("js.experience.signup_dialog.agree"),
                signUp: o("js.experience.signup_dialog.signup_button"),
                loginText: o("js.experience.signup_dialog.already_have"),
                loginLink: o("js.experience.signup_dialog.login_here"),
                remember: o("js.experience.signup_dialog.remember_me"),
                hide_password: o("js.experience.signup_dialog.hide"),
                show_password: o("js.experience.signup_dialog.show")
            },
            terms: [],
            autoAccept: !1
        },
        dialogOptions: {
            title: o("js.signup_dialog.title"),
            width: 360,
            fixed: !1,
            dialogClass: "signup-dialog"
        },
        validatorConf: {
            validationEvents: {
                submit: !0,
                blur: !1,
                change: !0
            }
        },
        container: "#SignUpDialog",
        domEvents: {
            "click .login": "onRequireLogin",
            "click .requiredTabsComponent li": "onTosTabSelect"
        },
        getFormData: function(i) {
            var e = {};
            return $.forEach(this.form.serializeArray(), function(i) {
                e[i.name] = i.value
            }), i && i.isAlign && (e["signup[align]"] = 1), i && i.isPro && (e["signup[pro]"] = 1), i && i.planId && (e.planId = i.planId), e
        },
        setupPasswordField: function() {
            var i = this.container;
            new a({
                delegate: i
            }), new s({
                delegate: i
            })
        },
        applyErrors: function(i) {
            $(".password-info").remove(), this.validator.applyErrors(i)
        },
        showCaptcha: function(i) {
            i = i || {}, this.recaptcha || (i.wrapId = "RecaptchaContainerSignup", this.recaptcha = new e({
                recaptchaOptions: i
            })), this.fixPositioningWithCaptcha(), this.recaptcha.set()
        },
        createCaptchaWrap: function(i) {
            this.container.find(".recaptchaWrap").length || $('<div class="recaptchaWrap"><div id="RecaptchaContainerSignup" class="g-recaptcha" data-sitekey="' + i.sitekey + '"></div></div>').insertAfter($("#ClassicPassword").parents(".control-group"))
        },
        fixPositioningWithCaptcha: function() {
            var i, e = $(window).height(),
                a = this.form,
                s = a.closest(".ui-dialog"),
                t = s.height(),
                n = s.offset().top;
            $("#recaptcha_area").length || (t += 129), e < t ? a.closest(".ui-dialog").removeClass("fixed") : e < t + n ? (i = (e - t) / 2, a.closest(".ui-dialog").css({
                top: i
            })) : a.closest(".ui-dialog").addClass("fixed")
        },
        setTerms: function(i) {
            this.dialogTemplateOptions.terms = i
        },
        onFormValid: function() {
            this.emit("formValid")
        },
        onFieldInvalid: function(i, e) {
            if ("userpassword" === e.validator) {
                var a = {
                        digit: /(?=.*\d)/,
                        upper: /(?=.*[A-Z])/,
                        lower: /(?=.*[a-z])/,
                        length: /(?=.{5,})/
                    },
                    s = e.field.val(),
                    t = e.field.siblings(".tooltip-error");
                for (var n in t.find(".active").removeClass("active"), a) a[n].test(s) || t.find("." + n).addClass("active")
            }
        },
        setActiveTab: function(i) {
            this.container.find(r.TAB_COMPONENT_SELECTOR).find("li").removeClass(r.ACTIVE_TAB_CLASS), i.addClass(r.ACTIVE_TAB_CLASS)
        },
        onTosTabSelect: function(i) {
            var e = $(i.target).closest("li");
            this.setActiveTab(e)
        },
        setTosValidState: function(i, e) {
            var a = "boolean" == typeof e ? e : i.find(r.TOS_CHECKBOX_SELECTOR).is(":checked");
            i.toggleClass("valid", a).toggleClass("error", !a), a || this.setActiveTab(i.parent().find(".error").eq(0))
        },
        onFieldValidation: function(i) {
            var e = $(i.target),
                a = n.events;
            e.is(r.TOS_CHECKBOX_SELECTOR) && this.setTosValidState(e.closest("li"), i.type === a.FIELD_VALID)
        },
        createDialog: function() {
            var i = !this.hasDialog,
                e = n.events;
            this.parent(), i && (this.setupPasswordField(), this.setActiveTab(this.container.find(r.TAB_COMPONENT_SELECTOR).find("li").eq(0)), this.validator.on(e.FIELD_INVALID, t.bind(this.onFieldValidation, this)), this.validator.on(e.FIELD_VALID, t.bind(this.onFieldValidation, this)))
        },
        open: function() {
            this.parent(), this.container.find(r.EMAIL_INPUT_SELECTOR).focus(), this.showCaptcha()
        },
        onRequireLogin: function(i) {
            i.preventDefault(), this.emit("requireLogin")
        }
    })).TAB_COMPONENT_SELECTOR = ".requiredTabsComponent", r.ACTIVE_TAB_CLASS = "tabActive", r.TOS_CHECKBOX_SELECTOR = ".signup-tos", r.EMAIL_INPUT_SELECTOR = 'input[name="signup[email]"]', r
});
define("classes/Signup/Standalone/View", ["classes/Signup/View", "events", "lodash", "uvalidator"], function(n, t, e, o) {
    return n.extend({
        template: null,
        container: "#SignUpDialog",
        initialize: function(i, n) {
            this.parent(i, n), this.open(), this.resizePopup()
        },
        resizePopup: function() {
            var i, n;
            window.opener && window.opener !== window.self && (n = $("#SignUpDialog"), i = $("#Header").height() + n.height() + n.position().top, window.resizeTo(360, i), window.resizeTo(360, i + (i - $(window).height())))
        },
        open: function() {
            this.createDialog(), this.container.find(n.EMAIL_INPUT_SELECTOR).focus(), $("#LoginSignupLanding").remove(), t.dispatch("CLEARLASTNOTIFICATION"), this.showCaptcha()
        },
        createDialog: function() {
            var i = o.events;
            this.form = this.container.find("form"), this.hasDialog = !0, this.setupValidator(), t.dispatch("RESETPLACEHOLDERS"), this.setupPasswordField(), this.setActiveTab(this.container.find(n.TAB_COMPONENT_SELECTOR).find("li").eq(0)), this.validator.on(i.FIELD_INVALID, e.bind(this.onFieldValidation, this)), this.validator.on(i.FIELD_VALID, e.bind(this.onFieldValidation, this))
        },
        submit: function() {
            this.form.submit()
        },
        onRequireLogin: function() {
            this.emit("requireLogin")
        },
        close: function() {},
        fixPositioningWithCaptcha: function() {}
    })
});
define("classes/Signup/Controller", ["classes/DialogForm/Controller", "events", "jsdebug", "lodash", "exposedVars"], function(e, i, s, t, o) {
    return e.extend({
        viewEvents: {
            requireLogin: "onRequireLogin",
            formValid: "onFormValid"
        },
        onRequiredAgreementsSuccess: function(e, i) {
            var s, t, r = i.required;
            for (t = 0, s = r.length; t < s; t += 1) r[t].id = 0 === t ? "" : t;
            this.view.dialogTemplateOptions.autoAccept = "en_US" === o.get("locale"), this.view.setTerms(r), this.view.open(e), e && e.dialogTitle && this.view.setDialogTitle(e.dialogTitle)
        },
        onRequiredAgreementsError: function(e) {
            e && e.error && e.error.message && (s.error("SignupController ERROR: " + e.error.message), i.dispatch("ERRORNOTIFICATION", {
                message: e.error.message,
                sticky: !0,
                clearQueue: !0
            }))
        },
        start: function(e) {
            this.parent(e), this.model.getRequiredAgreements(t.bind(this.onRequiredAgreementsSuccess, this, e), t.bind(this.onRequiredAgreementsError, this))
        },
        onRequireLogin: function() {
            this.view.close(), i.dispatch("REQUIRELOGIN", {
                loginFlow: !0
            })
        },
        onSignupSuccessful: function(e) {
            o.set("newClassicSignUp", !0), i.dispatch("LOGINREQUESTWITHRESPONSEDATA", e), this.view.noLoad()
        },
        onSignupError: function(e) {
            e && e.showCaptcha ? (this.view.createCaptchaWrap(e.captchaOptions), this.view.showCaptcha(e.captchaOptions), i.dispatch("ERRORNOTIFICATION", {
                message: e.error.message,
                sticky: !0,
                clearQueue: !0
            })) : this.view.applyErrors(e.error.formFields), this.view.noLoad()
        },
        onFormValid: function() {
            var e = this.view.getFormData({
                isAlign: this.isAlign,
                isPro: this.isPro,
                planId: this.planId
            });
            this.view.load(), this.model.signupUser(e, t.bind(this.onSignupSuccessful, this), t.bind(this.onSignupError, this))
        },
        onDialogClosed: function(e) {
            this.parent(e), this.view.isDialogOpened && i.dispatch("SIGNUPDIALOGCLOSED")
        }
    })
});
define("classes/Signup/Standalone/Controller", ["classes/Signup/Controller", "exposedVars"], function(e, r) {
    return e.extend({
        onSignupSuccessful: function(e) {
            e.redirectUrl || (e.redirectUrl = "/"), r.get("signupSuccessRedirectUrl") && (e.redirectUrl = r.get("signupSuccessRedirectUrl")), this.parent(e)
        }
    })
});
define("classes/Signup/Factory", ["classes/Signup/View", "classes/Signup/Standalone/View", "classes/Signup/Controller", "classes/Signup/Standalone/Controller", "models/AuthenticationModel", "models/StandaloneAuthenticationModel", "exposedVars"], function(a, s, o, l, i, c, u) {
    return {
        createSignup: function() {
            var e, n, t;
            return "Signup_Standalone" === u.get("pageId") ? (n = l, e = new s, t = c.getInstance()) : (n = o, e = new a, t = i.getInstance()), new n(e, t)
        }
    }
});
define("classes/Login/AlignOverlays/View", ["abstracts/View", "lodash", "dialog", "i18n"], function(i, o, t, e) {
    return i.extend({
        container: "body",
        terminatedTemplate: '<div><p class="ui-dialog-content-text">' + e("js.login.align_termination_overlay.text_main") + '</p><p class="ui-dialog-content-text ui-dialog-content-secondary-text">' + e("js.login.align_termination_overlay.text_renew") + '</p><div class="ui-dialog-footer"><button id="CloseSSErrorDialog" class="button" type="button">' + e("js.login.align_termination_overlay.close") + "</button></div></div>",
        errorDialog: null,
        showErrorDialog: function() {
            this.createErrorDialog(), t(this.errorDialog, "open")
        },
        createErrorDialog: function() {
            this.errorDialog || (this.errorDialog = t($(this.terminatedTemplate), {
                title: e("js.login.align_termination_overlay.title"),
                modal: !0,
                resizable: !1,
                draggable: !1,
                autoOpen: !1,
                closeOnEscape: !0,
                width: 360
            }), $("#CloseSSErrorDialog").click(o.bind(function() {
                t(this.errorDialog, "close")
            }, this)))
        }
    })
});
define("classes/Login/AlignOverlays/Controller", ["abstracts/Controller", "classes/Login/AlignOverlays/View"], function(i, n) {
    return i.extend({
        initialize: function() {
            this.view = new n, this.parent()
        },
        showErrorDialog: function() {
            this.view.showErrorDialog()
        }
    })
});
define("classes/Login/View", ["classes/Recaptcha", "classes/DialogForm/View", "coverLayer", "lodash", "i18n", "exposedVars"], function(t, i, e, o, a, n) {
    return i.extend({
        __mixin: [e],
        dialogOptions: {
            title: a("js.login.combined.title"),
            modal: !0,
            autoOpen: !1,
            width: 713,
            fixed: !1
        },
        container: "#LoginDialog",
        domEvents: {
            "click .facebookSignIn": "!facebookLoginRequest",
            "click .classicSignUp": "onRequireSignup",
            "click .js-login-dialog-forgot": "onForgotPassword"
        },
        validatorConf: {
            validationEvents: {
                submit: !0,
                blur: !1,
                change: !0
            }
        },
        getFormData: function(i) {
            var e = {};
            return $.forEach(this.form.serializeArray(), function(i) {
                e[i.name] = i.value
            }), i && i.isAlign && (e.align = 1), i && i.isPro && (e.pro = 1), i && i.planId && (e.planId = i.planId), e.remember = this.form.find('input[name="remember"]').is(":checked"), e
        },
        setUnathorized: function(i) {
            var e = this.form,
                t = e.find('input[name="username"]'),
                a = e.find('input[name="password"]'),
                n = this.validator;
            n.addFieldError(this.usernameField, {
                field: t,
                message: i
            }), n.setFieldInvalid(t), n.setFieldInvalid(a), t.focus().one("blur", o.bind(function() {
                n.hideFieldError(t), n.hideFieldError(a), n.setFieldValid(t), n.setFieldValid(a)
            }, this))
        },
        fixPositioningWithCaptcha: function() {
            var i, e = $(window).height(),
                t = this.form,
                a = t.closest(".ui-dialog"),
                n = a.height(),
                o = a.offset().top;
            $("#recaptcha_area").length || (n += 129), e < n ? t.closest(".ui-dialog").removeClass("fixed") : e < n + o ? (i = (e - n) / 2, t.closest(".ui-dialog").css({
                top: i
            })) : t.closest(".ui-dialog").addClass("fixed")
        },
        showCaptcha: function(i) {
            var e = i || {};
            this.recaptcha || (e.wrapId = "RecaptchaContainerLogin", this.recaptcha = new t({
                recaptchaOptions: e
            })), this.fixPositioningWithCaptcha(), this.recaptcha.set()
        },
        createCaptchaWrap: function(i) {
            this.container.find(".recaptchaWrap").length || $('<div class="recaptchaWrap"><div id="RecaptchaContainerSignup" class="g-recaptcha" data-sitekey="' + i.sitekey + '"></div></div>').insertAfter($("#SignUpPassword").parents(".control-group"))
        },
        open: function() {
            this.noLoad(), this.parent(), this.showCaptcha({})
        },
        onFormValid: function() {
            this.emit("formValid")
        },
        onDialogOpen: function() {
            this.parent(), this.container.find('input[name="username"]').focus()
        },
        onForgotPassword: function(i) {
            i.preventDefault(), this.emit("forgotPassword")
        },
        onRequireSignup: function(i) {
            i.preventDefault(), this.emit("requireSignup")
        },
        setInitedState: function() {
            n.set("loginInited", !0)
        }
    })
});
define("classes/Login/Standalone/View", ["classes/Login/View", "events"], function(i, n) {
    return i.extend({
        initialize: function(i, n) {
            this.parent(i, n), this.open(), this.resizePopup()
        },
        resizePopup: function() {
            var i, n;
            window.opener && window.opener !== window.self && (i = $("#LoginDialog"), n = $("#Header").height() + i.height() + i.position().top, window.resizeTo(716, n), window.resizeTo(716, n + (n - $(window).height())))
        },
        open: function() {
            this.form = this.container.find("form"), this.setupValidator(), this.container.find('input[name="username"]').focus(), $("#LoginSignupLanding").remove(), n.dispatch("CLEARLASTNOTIFICATION"), this.showCaptcha()
        },
        fixPositioningWithCaptcha: function() {},
        submit: function() {
            this.form[0].submit()
        },
        close: function() {},
        onRequireSignup: function() {
            this.emit("requireSignup")
        },
        onForgotPassword: function() {
            this.emit("forgotPassword")
        }
    })
});
define("classes/Login/Controller", ["classes/DialogForm/Controller", "events", "storage", "lodash", "ustream-centrallogging", "i18n"], function(i, e, o, s, r, t) {
    return i.extend({
        viewEvents: {
            formValid: "onFormValid",
            facebookLoginRequest: "onFacebookLoginRequest",
            requireSignup: "onRequireSignup",
            forgotPassword: "onForgotPassword",
            dialogClosed: "onDialogClosed"
        },
        initialize: function(i, e) {
            this.parent(i, e), this.loginProgress = !1, this.view.setInitedState(), this.logger = r.create({
                subdomain: "eventtracking-log",
                tag: "eventtracking.dashboard",
                type: "web",
                callback: function(i) {
                    if (i) throw i
                }
            })
        },
        start: function(i) {
            this.parent(i), this.view.open(), i.dialogTitle && this.view.setDialogTitle(i.dialogTitle)
        },
        onLoginSuccessful: function(i) {
            this.loginProgress = !1, e.dispatch("LOGINREQUESTWITHRESPONSEDATA", i), this.view.noLoad()
        },
        showCaptcha: function(i) {
            this.view.createCaptchaWrap(i.captchaOptions), this.view.showCaptcha(i.captchaOptions)
        },
        alignOverlays: null,
        showSSAlignErrorOverlay: function() {
            this.alignOverlays ? (this.view.close(), this.alignOverlays.showErrorDialog()) : require(["classes/Login/AlignOverlays/Controller"], s.bind(function(i) {
                this.alignOverlays = new i, this.view.close(), this.alignOverlays.showErrorDialog()
            }, this))
        },
        errorWithResponse: function(i) {
            "unauthorized" === i.error.code ? this.view.setUnathorized(i.error.message) : e.dispatch("ERRORNOTIFICATION", {
                message: i.error.message,
                sticky: !0,
                clearQueue: !0
            })
        },
        erroWithoutResponse: function() {
            e.dispatch("ERRORNOTIFICATION", {
                message: t("js.experience.login_dialogs.common_error"),
                sticky: !0,
                clearQueue: !0
            })
        },
        onForgotPassword: function() {
            var i = this.view.getFormData();
            o.set("session.tempUserName", i.username), this.view.load(), e.dispatch("FORGOTPASSWORD")
        },
        onLoginError: function(i) {
            this.loginProgress = !1, i && i.redirectTo && 0 !== window.location.pathname.indexOf(i.redirectTo) ? window.location.href = i.redirectTo : (i && i.showCaptcha ? this.showCaptcha(i) : i.error && "expired_align" === i.error.code ? this.showSSAlignErrorOverlay() : i.error && i.error.message ? this.errorWithResponse(i) : this.erroWithoutResponse(), this.view.noLoad())
        },
        onFormValid: function() {
            if (!this.loginProgress) {
                var i = this.view.getFormData({
                    isAlign: this.isAlign,
                    isPro: this.isPro,
                    planId: this.planId
                });
                this.view.load(), this.loginProgress = !0, this.model.loginUser(i, s.bind(this.onLoginSuccessful, this), s.bind(this.onLoginError, this))
            }
        },
        onFacebookLoginRequest: function() {
            e.dispatch("FACEBOOKCONNECT", {
                openerId: "loginsignupexperience"
            });
            this.logger && this.logger.send([{
                data: {
                    product: "facebook-loginclick"
                }
            }])
        },
        onRequireSignup: function() {
            this.view.close(), e.dispatch("REQUIRECLASSICSIGNUP", {
                loginFlow: !0
            })
        }
    })
});
define("classes/Login/Standalone/Controller", ["classes/Login/Controller", "storage"], function(e, n) {
    return e.extend({
        corsRequired: !1,
        onFormValid: function() {
            this.parent(), this.view.submit()
        },
        onForgotPassword: function() {
            var e = this.view.getFormData();
            n.set("session.tempUserName", e.username)
        }
    })
});
define("classes/Login/Factory", ["classes/Login/View", "classes/Login/Standalone/View", "classes/Login/Controller", "classes/Login/Standalone/Controller", "models/AuthenticationModel", "models/StandaloneAuthenticationModel", "exposedVars"], function(t, a, s, l, i, c, r) {
    return {
        createLogin: function() {
            var e, n, o;
            return "Login_Standalone" === r.get("pageId") ? (o = c.getInstance(), e = new a, n = l) : (o = i.getInstance(), e = new t, n = s), new n(e, o)
        }
    }
});
define("classes/ForgotPassword/View", ["classes/DialogForm/View", "coverLayer", "lodash", "i18n"], function(i, t, e, n) {
    return i.extend({
        __mixin: [t],
        dialogOptions: {
            title: n("js.forgot_password.title"),
            modal: !0,
            autoOpen: !1,
            width: 360,
            fixed: !1
        },
        container: "#ForgotPasswordDialog",
        domEvents: {
            "click .backtoLogin": "onBacktoLogin",
            "click .forgot-password-close": "onFinishClick"
        },
        validatorConf: {
            validationEvents: {
                submit: !0,
                blur: !1,
                change: !0
            }
        },
        initialize: function(i) {
            i && ($("#Header").length ? $("#Header") : $(".site-header")).append(i);
            this.parent(), this.container.hasClass("finished") && (this.dialogOptions.title = n("js.forgot_password.title_finish"))
        },
        getFormData: function() {
            var t = {};
            return $.forEach(this.form.serializeArray(), function(i) {
                t[i.name] = i.value
            }), t
        },
        setUnathorized: function(i) {
            var t = this.form.find('input[name="usernameemail"]'),
                n = this.validator;
            n.addFieldError(this.usernameField, {
                field: t,
                message: i
            }), n.setFieldInvalid(t), t.focus().one("blur", e.bind(function() {
                n.hideFieldError(t), n.setFieldValid(t)
            }, this))
        },
        setFinished: function() {
            this.container.addClass("finished"), this.setDialogTitle(n("js.forgot_password.title_finish"))
        },
        onFormValid: function() {
            this.emit("formValid")
        },
        onDialogOpen: function() {
            this.parent(), this.container.find('[name="usernameemail"]').focus()
        },
        onBacktoLogin: function(i) {
            i.preventDefault(), this.emit("requireLogin")
        },
        onFinishClick: function() {
            this.close()
        },
        getForgotPasswordUrl: function() {
            return this.form.attr("action")
        },
        onDialogClose: function(i) {
            this.container.removeClass("finished"), this.parent(i)
        }
    })
});
define("classes/ForgotPassword/Standalone/View", ["classes/ForgotPassword/View", "events"], function(i, n) {
    return i.extend({
        initialize: function(i, n) {
            this.parent(i, n), this.open(), this.resizePopup()
        },
        resizePopup: function() {
            var i, n;
            window.opener && window.opener !== window.self && (n = $("#ForgotPasswordDialog"), i = $("#Header").height() + n.height() + n.position().top, window.resizeTo(716, i), window.resizeTo(716, i + (i - $(window).height())))
        },
        open: function() {
            this.form = this.container.find("form"), this.setupValidator(), this.container.find('[name="usernameemail"]').focus(), n.dispatch("CLEARLASTNOTIFICATION")
        },
        submit: function() {
            this.form[0].submit()
        },
        onBacktoLogin: function() {
            this.emit("requireLogin")
        },
        onFinishClick: function() {
            this.emit("finish")
        }
    })
});
define("classes/ForgotPassword/Controller", ["classes/DialogForm/Controller", "events", "storage", "lodash", "i18n"], function(e, i, s, o, r) {
    return e.extend({
        viewEvents: {
            formValid: "onFormValid",
            requireLogin: "onRequireLogin",
            dialogClosed: "onDialogClosed"
        },
        initialize: function(e, s) {
            this.parent(e, s), this.getLoginUser()
        },
        getLoginUser: function() {
            var e = s.get("session.tempUserName");
            e.success && (this.view.setData("usernameemail", e.value), s.remove("session.tempUserName"))
        },
        start: function(e) {
            this.parent(e), this.view.open(), e && e.dialogTitle && this.view.setDialogTitle(e.dialogTitle)
        },
        errorWithResponse: function(e) {
            var s = e.error && e.error.message ? e.error.message : r("js.experience.login_dialogs.common_error");
            i.dispatch("ERRORNOTIFICATION", {
                message: s,
                sticky: !0,
                clearQueue: !0
            })
        },
        onRequireLogin: function() {
            this.view.close(), i.dispatch("REQUIRELOGIN", {
                loginFlow: !0
            })
        },
        onSuccess: function() {
            this.progress = !1, this.view.noLoad(), this.view.setFinished()
        },
        onError: function(e) {
            this.progress = !1, this.errorWithResponse(e), this.view.noLoad()
        },
        onFormValid: function() {
            if (!this.progress) {
                var e = this.view.getFormData();
                this.view.load(), this.progress = !0, this.model.requestPasswordReset(e, o.bind(this.onSuccess, this), o.bind(this.onError, this))
            }
        }
    })
});
define("classes/ForgotPassword/Standalone/Controller", ["classes/ForgotPassword/Controller"], function(n) {
    return n.extend({
        viewEvents: {
            finish: "onFinish"
        },
        onFinish: function() {
            window.opener !== window && $(window).width() < 717 ? window.close() : window.location.href = "/"
        }
    })
});
define("classes/ForgotPassword/Factory", ["classes/ForgotPassword/View", "classes/ForgotPassword/Standalone/View", "classes/ForgotPassword/Controller", "classes/ForgotPassword/Standalone/Controller", "models/AuthenticationModel", "models/StandaloneAuthenticationModel", "exposedVars"], function(t, e, a, r, n, d, l) {
    return {
        createForgotPassword: function() {
            var o, s;
            return "Login_ForgotPassword" === l.get("pageId") && (s = d.getInstance(), o = new e, s.forgotPassowrdUrl = o.getForgotPasswordUrl(), new r(o, s))
        },
        lazyCreateForgotPassword: function(o) {
            var s, e, r;
            return r = n.getInstance(), s = new t(o), e = new a(s, r), s.on("dialogOpened", function() {
                this.model.forgotPassowrdUrl = this.view.getForgotPasswordUrl()
            }, e), e
        }
    }
});
define("classes/Authentication/BeforeRedirectQueue", function() {
    return function() {
        var t = [],
            r = 0,
            e = $.Deferred();

        function i() {
            (r -= 1) ? e.notify(): e.resolve()
        }
        return {
            promise: e,
            add: function(e) {
                t.push(e)
            },
            start: function() {
                var e, n = t.length;
                for (e = 0; e < n; e++) r += 1, t[e](i)
            }
        }
    }
});
define("classes/Authentication/View", ["abstracts/View", "coverLayer", "dialog"], function(o, n, i) {
    return o.extend({
        __mixin: [n],
        container: "body",
        loadBody: function() {
            this.cover("body")
        },
        noLoad: function() {
            this.uncover()
        },
        closeAllDialog: function() {
            i($(".ui-dialog-content"), "close")
        }
    })
});
define("classes/Authentication/Controller", ["abstracts/Controller", "classes/Authentication/BeforeRedirectQueue", "models/CurrentUserModel", "classes/TosManager", "events", "storage", "exposedVars"], function(e, o, i, t, s, r, n) {
    return e.extend({
        viewEvents: {
            requireLogin: "onViewRequireLogin"
        },
        initialize: function(e, t, o, i, s) {
            this.view = e, this.model = t, this.login = i, this.signUp = o, this.forgotPassword = s, this.captureEvents(), this.setupBeforeRedirectQueue(), this.redirectData = {}, n.get("tos") && this.showTos(), this.parent()
        },
        captureEvents: function() {
            s.capture("REQUIRELOGIN", $.proxy(this.onRequireLogin, this)), s.capture("REQUIREAJAXLOGIN", $.proxy(this.onRequireLogin, this)), s.capture("REQUIRECLASSICSIGNUP", $.proxy(this.onRequireSignup, this)), s.capture("FORGOTPASSWORD", $.proxy(this.onForgotPassword, this)), s.capture("LOGINREQUESTWITHRESPONSEDATA", $.proxy(this.onLoginResponse, this)), s.capture("FACEBOOKCONNECTED", $.proxy(this.onFacebookConnected, this)), s.capture("FACEBOOKCONNECTPERMISSIONERROR", $.proxy(this.onPermissionError, this))
        },
        onAuthRequest: function(e) {
            this.view.closeAllDialog(), this.overwriteEventData(e)
        },
        redirect: function(e) {
            var t, o;
            t = window.location, o = "signup" === e ? "/signup" : "/login", o += "?ref=" + encodeURIComponent(t.pathname + t.search), window.location.href = o
        },
        onRequireLogin: function(e) {
            this.onAuthRequest(e), this.redirect("login")
        },
        onRequireSignup: function(e) {
            this.onAuthRequest(e), this.redirect("signup")
        },
        onForgotPassword: function() {
            this.forgotPassword.start ? (this.view.closeAllDialog(), this.forgotPassword.start()) : this.model.getForgotPasswordOverlay($.proxy(this.onGetForgotPasswordSuccess, this), $.proxy(this.onGetForgotPasswordFailure, this))
        },
        onGetForgotPasswordSuccess: function(e) {
            this.view.closeAllDialog(), e.success && e.overlay && (this.forgotPassword = this.forgotPassword.lazyCreateForgotPassword(e.overlay), this.forgotPassword.start())
        },
        onGetForgotPasswordFailure: function() {},
        onPermissionError: function(e) {
            var t = {};
            "object" == typeof e && e.eventData && (t = e.eventData), t.message && s.dispatch("INFONOTIFICATION", {
                message: t.message,
                sticky: !0,
                clearQueue: !0
            }), s.dispatch("REQUIRECLASSICSIGNUP", {
                gaTriggerLabel: "Facebook Connect Permission Error"
            })
        },
        onFacebookConnected: function(e) {
            !n.get("loggedIn") && e.eventData.exposedVariables.loggedIn && this.onLoginResponse(e)
        },
        setupBeforeRedirectQueue: function() {
            this.beforeRedirectQueue = new o;
            var t = this.beforeRedirectQueue;
            s.capture("REQUESTCALLBEFORELOGINREDIRECT", $.proxy(function(e) {
                t.add(e.eventData)
            }, this)), t.promise.always($.proxy(this.finishLoginProcess, this))
        },
        onViewRequireLogin: function() {
            s.dispatch("REQUIRELOGIN")
        },
        overwriteEventData: function(e) {
            var t;
            "object" == typeof e && e.eventData ? ((t = e.eventData).loginFlow || (this.eventData = t), t.gaTriggerLabel ? this.eventData.gaTriggerLabel = t.gaTriggerLabel : this.eventData.gaTriggerLabel = "") : this.eventData = {}
        },
        onLoginResponse: function(e) {
            var t = e.eventData && e.eventData.exposedVariables;
            ustream.vars = $.extend(!0, ustream.vars, t), i.getInstance().updateData(), this.eventData = $.extend(!0, this.eventData, t), this.eventData.redirectUrl = e.eventData && e.eventData.redirectUrl, this.view.closeAllDialog(), s.dispatch("USERAUTHENTICATED"), r.set("local.ustream-login-data", t), this.showTos()
        },
        setReloadLogic: function() {
            var e = this.eventData,
                t = this.getRefURL(),
                o = window.location.pathname + window.location.search,
                i = this.redirectData;
            t && (t === o ? i.reload = !0 : i.href = t), e.redirectUrl && e.allowRedirect && (e.redirectUrl === o ? i.reload = !0 : i.href = e.redirectUrl)
        },
        getRefURL: function() {
            var e, t, o, i, s = window.location,
                r = ustream.vars,
                n = s.search;
            return o = "Login_Standalone" === r.pageId || "Signup_Standalone" === r.pageId, i = -1 < s.search.indexOf("opener="), e = this.eventData, t = !1, n.match(/(\?|&)ref=(.*)/) && !i ? "" === (t = this.model.getRefUrl(s)) && (t = !1) : e && e.redirectUrl && !i ? t = e.redirectUrl : o && (t = "/", i && r.connectLandingUrls && (t = r.connectLandingUrls.http, -1 < s.search.indexOf("https=") && (t = r.connectLandingUrls.https))), t
        },
        finishLoginProcess: function() {
            this.setReloadLogic();
            var e = this.redirectData,
                t = this.eventData;
            if (e.reload ? window.location.reload(!0) : e.href && (window.location.href = e.href), e.href || e.reload) return t.redirecting = !0, void this.view.loadBody();
            t.allowRedirect = null, t.redirecting = null
        },
        userCompletelyAuthenticated: function() {
            s.dispatch("LOGINSUCCESS", this.eventData), this.beforeRedirectQueue.start(), $.cookie("ustream-last-login", (new Date).getTime())
        },
        showTos: function() {
            this.tosManager ? this.tosManager.setup() : (s.capture("ALLTOSACCEPTED", $.proxy(this.userCompletelyAuthenticated, this)), this.tosManager = new t)
        }
    })
});
define("classes/Authentication/LoggedInDataSyncer", ["storage", "cookie", "models/AuthenticationModel", "events"], function(o, r, d, n) {
    function l() {
        $(document.body).addClass("login-data-checked")
    }

    function i(e) {
        e.error || (e.exposedVariables.userDataSync = !0, n.dispatch("LOGINREQUESTWITHRESPONSEDATA", e)), e.error && "unauthorized" === e.error.code && (r("ustream-loggedin", null), r("ustream-loggedin-id", null)), l()
    }

    function c() {
        var e = window.location.href;
        return "1" === r("ustream-loggedin") && /^http:.*/.test(e)
    }
    return {
        checkIfSyncNeeded: c,
        sync: function() {
            var e, n, t = o.get("local.ustream-login-data").value,
                a = r("ustream-loggedin-id");
            t && +t.loggedInUserId != +a && (t = !1, o.remove("local.ustream-login-data")), c() ? (e = r("ustream-last-login"), n = (new Date).getTime(), e && !(3e4 < n - e) && t && t.loggedIn ? i({
                exposedVariables: t
            }) : d.getInstance().getLoggedInData(i, i)) : l()
        },
        clear: function() {
            o.remove("local.ustream-login-data")
        }
    }
});
define("classes/Authentication/Factory", ["classes/Authentication/Controller", "classes/Authentication/View", "classes/Authentication/LoggedInDataSyncer", "classes/PostLoginOverlayManager", "models/AuthenticationModel", "classes/Signup/Factory", "classes/Login/Factory", "classes/ForgotPassword/Factory", "models/Features", "classes/FacebookAutoLogin", "events"], function(c, i, r, l, g, u, d, h, w, L, A) {
    return {
        repack: !0,
        createAuthentication: function() {
            new L;
            var e, t = u.createSignup(),
                a = d.createLogin(),
                n = h.createForgotPassword() || h,
                s = new i,
                o = g.getInstance();
            return (e = new c(s, o, t, a, n)).corsRequired = "https:" !== window.location.protocol, A.dispatch("REQUESTCALLBEFORELOGINREDIRECT", function(e) {
                new l({
                    callback: e
                }).start()
            }), r.sync(), -1 < window.location.hash.indexOf("login") && A.dispatch("REQUIRELOGIN", {
                gaTriggerLabel: "URL Hashtag"
            }), w.getInstance().register("Authentication"), e
        }
    }
});
! function(e, i) {
    define("classes/FollowV5", ["datasources/AjaxDataSource", "events"], function(s, o) {
        return $.klass({
            options: {
                selector: ".button.follow",
                followUrl: ustream.vars.followUrl,
                unfollowUrl: ustream.vars.unfollowUrl
            },
            shouldFollowAfterLogin: !1,
            initialize: function(t) {
                this.options = $.klass.merge(this.options, t || {}), this.options.followUrl && this.options.unfollowUrl && ($("body").on("click", this.options.selector, $.proxy(this.onClick, this)), o.capture("LOGINSUCCESS", $.proxy(this.onLogin, this)), o.capture("EXPLORELISTLOADED", $.proxy(this.removeLoginListening, this)), o.capture("STATECHANGE", $.proxy(this.removeLoginListening, this)), this.listenEvents())
            },
            listenEvents: function() {
                o.capture("ONSUCCESFULFOLLOW", $.proxy(this.onCrowdJoin, this)), o.capture("ONSUCCESFULUNFOLLOW", $.proxy(this.onCrowdLeave, this))
            },
            getButtonsFromEvent: function(t) {
                return $(this.options.selector).filter('[data-id="' + t.eventData.channelId + '"]')
            },
            onCrowdJoin: function(t) {
                this.getButtonsFromEvent(t).addClass("on")
            },
            onCrowdLeave: function(t) {
                this.getButtonsFromEvent(t).removeClass("on")
            },
            removeLoginListening: function() {
                this.shouldFollowAfterLogin = !1
            },
            onClick: function(t) {
                if (!this.busy) {
                    var s = $(t.target);
                    ustream.state && "channel" === ustream.state.view && ".button.follow" === this.options.selector && (s = $("a.follow"), o.dispatch("HIDEFOLLOWCTA")), this.target = s.closest(".button"), ustream.vars.loggedInUserId ? this.submit() : (this.shouldFollowAfterLogin = !0, o.dispatch("REQUIREAJAXLOGIN", {
                        gaTriggerLabel: "Follow Button Clicked",
                        dialogTitle: i("js.login.follow.title")
                    }))
                }
            },
            onLogin: function() {
                this.shouldFollowAfterLogin && (this.submit(), this.shouldFollowAfterLogin = !1)
            },
            submit: function() {
                if (this.target && this.target.length) {
                    var t = this.target.hasClass("on") ? this.options.unfollowUrl : this.options.followUrl;
                    t = e.urlSubst(t, {
                        ID: this.target.attr("data-id")
                    }), this.setBusy(!0), s.getInstance().request({
                        url: t,
                        xhrFields: {
                            withCredentials: !0
                        },
                        success: $.proxy(this.onResponse, this),
                        error: $.proxy(this.onResponse, this),
                        method: "POST"
                    })
                }
            },
            dispatchResponseEvents: function(t) {
                var s;
                t.channelId, s = t.activity, this.target, "joincrowd" === s ? o.dispatch("ONSUCCESFULFOLLOW", {
                    ogUrl: t.ogUrl,
                    channelId: t.channelId,
                    target: this.target
                }) : "leavecrowd" === s && o.dispatch("ONSUCCESFULUNFOLLOW", {
                    channelId: t.channelId,
                    target: this.target
                })
            },
            onResponse: function(t) {
                o.dispatch("AJAXNOTIFICATION", {
                    response: t
                }), $.console.log(t), this.setBusy(!1), t.success && (this.dispatchResponseEvents(t), o.dispatch("ONFOLLOW", {
                    target: this.target
                })), this.target = null
            },
            setBusy: function(t) {
                this.busy = t, this.target.toggleClass("busy", t), this.target.toggleClass("disabled", t), this.target.prop("disabled", t), this.target.parent().toggleClass("busy", this.busy)
            }
        })
    })
}(ustream.framework.stringUtils, ustream.framework.i18n._t_);
define("classes/RsvpV5", ["classes/Follow", "datasources/AjaxDataSource", "events"], function(t, r, o) {
    return t.extend({
        options: {
            selector: ".button.remind",
            followUrl: ustream.vars.attendUrl,
            unfollowUrl: ustream.vars.unattendUrl
        },
        listenEvents: function() {
            o.capture("ONSUCCESFULRSVP", $.proxy(this.onRsvp, this)), o.capture("ONSUCCESFULUNRSVP", $.proxy(this.onUnrsvp, this))
        },
        getButtonsFromEvent: function(t) {
            return $(this.options.selector).filter('[data-id="' + t.eventData.eventId + '"]')
        },
        submitNlbAction: function(t, e, n) {
            this.lockUI();
            var s = {};
            e && (s.email = e), $.extend(!0, s, n || {}), r.getInstance().request({
                url: t,
                type: "POST",
                xhrFields: {
                    withCredentials: !0
                },
                data: s,
                dataType: "json",
                success: $.proxy(this.nlbSuccSubmit, this, e),
                error: $.proxy(this.nlbSuccSubmit, this, e)
            })
        },
        onRsvp: function(t) {
            this.getButtonsFromEvent(t).addClass("on")
        },
        onUnrsvp: function(t) {
            this.getButtonsFromEvent(t).removeClass("on")
        },
        dispatchResponseEvents: function(t) {
            var e, n, s, r;
            n = t.channelId, e = t.activity, r = (s = this.target).attr("data-id"), "rsvp" === e ? o.dispatch("ONSUCCESFULRSVP", {
                ogUrl: t.ogUrl,
                channelId: n,
                eventId: r,
                target: s
            }) : "unrsvp" === e && o.dispatch("ONSUCCESFULUNRSVP", {
                channelId: n,
                eventId: r,
                target: s
            })
        }
    })
});
define("classes/Follow", ["classes/FollowV5", "classes/Authentication/LoggedInDataSyncer", "stringUtils"], function(t, e, o) {
    return t.extend({
        options: {
            mouseOverNS: "mouseover.follow",
            mouseOutNS: "mouseout.follow"
        },
        onCrowdJoin: function(t) {
            this.getButtonsFromEvent(t).addClass("button-undo button-secondary on")
        },
        onCrowdLeave: function(t) {
            this.getButtonsFromEvent(t).removeClass("button-undo button-secondary on")
        },
        setCrowdCounter: function(t) {
            this.target.next(".bubble").find("b").text(o.formatNumber(t, 0))
        },
        submit: function() {
            var t = this.target.next(".bubble").find("b").text().replace(",", ""),
                o = this.target.hasClass("on") ? -1 : 1;
            this.setCrowdCounter(+t + o), this.parent(), e.clear()
        }
    })
});
define("classes/Rsvp", ["classes/RsvpV5"], function(o) {
    return o.extend({
        options: {
            mouseOverNS: "mouseover.follow",
            mouseOutNS: "mouseout.follow"
        },
        onRsvp: function(o) {
            this.getButtonsFromEvent(o).addClass("on button-undo").removeClass("important")
        },
        onUnrsvp: function(o) {
            this.getButtonsFromEvent(o).removeClass("on button-undo").addClass("important")
        }
    })
});
ustream.framework.i18n._t_, ustream.classes.SimpleTabs = $.klass({
    options: {
        navClass: "tabNav",
        activeClass: "tabActive",
        contentClass: "tabContent",
        activeContentClass: "activeContent",
        activeIndex: 0,
        startIndex: 0,
        tabDistribution: !0
    },
    initialize: function(t, s) {
        this.options = $.klass.merge(this.options, s || {}), this.target = $(t), this.tabNav = this.target.find("." + this.options.navClass), this.tabNavItems = this.tabNav.find("li"), this.tabContents = this.tabNav.siblings(), this.tabsInit(), this.contentInit(), this.setEvents(), this.setActiveTab(this.options.startIndex)
    },
    tabsInit: function() {
        this.options.tabDistribution && this.tabNavItems.width(100 / this.tabNavItems.length + "%")
    },
    contentInit: function() {
        this.tabContents.hasClass(this.options.contentClass) || this.tabContents.addClass(this.options.contentClass), this.tabContents.hide().removeClass(this.options.activeContentClass)
    },
    setEvents: function() {
        this.target.on("click", "." + this.options.navClass + " li a", $.proxy(this._onTabClick, this))
    },
    setActiveTab: function(t) {
        this.tabNavItems.eq(this.activeIndex).removeClass(this.options.activeClass), this.tabNavItems.eq(t).addClass(this.options.activeClass), this.tabContents.eq(this.activeIndex).hide().removeClass(this.options.activeContentClass), this.tabContents.eq(t).show().addClass(this.options.activeContentClass), this.activeIndex = t
    },
    _onTabClick: function(t) {
        var s = $(t.currentTarget),
            i = s.parent();
        $(s.attr("href")), t.preventDefault(), this.activeIndex !== i.index() && this.setActiveTab(i.index())
    }
});
ustream.framework.i18n._t_, ustream.classes.RequiredTabs = $.klass({
    _valid: !0,
    _inputs: null,
    initialize: function(t) {
        this.tabs = $(t).find("li"), this.nav = this.tabs.find(".tabNav"), this._inputs = this.tabs.find('input[type="checkbox"]'), this.tabs.on("click", 'input[type="checkbox"]', $.proxy(this.onClickInput, this)).on("click", ".tabNav", $.proxy(this.onTabClick, this)), this.setActiveTab(0)
    },
    onTabClick: function(t) {
        var i = $(t.target).closest("li");
        this.setActiveTab(i.index())
    },
    isTabValid: function(t) {
        return !!this._inputs.eq(t).is(":checked")
    },
    isValid: function() {
        var t = 0;
        for (this._valid = !0; t < this.tabs.length; t += 1) this.setTabState(t);
        return this._valid
    },
    setTabState: function(t) {
        this.isTabValid(t) ? $(this.tabs[t]).removeClass("error").addClass("valid") : ($(this.tabs[t]).addClass("error").removeClass("valid"), this._valid && (this.setActiveTab(t), this._valid = !1))
    },
    setActiveTab: function(t) {
        this.tabs.removeClass("tabActive").eq(t).addClass("tabActive")
    },
    onClickInput: function(t) {
        this.setTabState(this._inputs.index(t.currentTarget))
    }
});
define("classes/PaymentNotification", ["i18n", "klass", "exposedVars"], function(e, i, n) {
    return i({
        initialize: function() {
            this.setNotifications()
        },
        setNotifications: function() {
            this.notifications = n.get("faildPaymentNotifications") || []
        },
        showNextNotification: function(i) {
            var t = this.getNext();
            t ? this.showNotification(t, i) : "function" == typeof i && (n.set("faildPaymentNotifications", null), i())
        },
        getNext: function() {
            var i = null;
            return 0 < this.notifications.length && (i = this.notifications.shift()), i
        },
        showNotification: function(i, t) {
            if (!this.confirm) {
                var n = new ustream.classes.AlertHandler({
                    title: e("js.notificationalert.title"),
                    onClose: $.proxy(function() {
                        this.showNextNotification(t)
                    }, this),
                    dialogOptions: {
                        width: 400,
                        modal: !0
                    }
                });
                this.alertHandler = n
            }
            this.alertHandler.setText(i.message), this.alertHandler.open(), this.saveView(i.subscriptionId, i.invoiceId)
        },
        saveView: function(i, t) {
            $.ajax({
                url: n.get("failedPaymentNotficationSaveUrl"),
                data: {
                    invoiceId: t,
                    subscriptionId: i,
                    _csrf_token: n.get("csrfToken")
                },
                xhrFields: {
                    withCredentials: !0
                },
                type: "POST"
            })
        }
    })
});
define("classes/Footer", ["klass"], function(e) {
    return new(e({
        initialize: function() {
            this.initCustomFormElements(), this.initCookiePreferencesLink()
        },
        initCustomFormElements: function() {
            $(".control-select").find("> select").ucustomSelect()
        },
        initCookiePreferencesLink: function() {
            $(".js-footer__cookie_preferences").length && $(".js-footer__cookie_preferences").on("click", function(e) {
                e.preventDefault();
                var n = document.querySelector("#teconsent > a"),
                    t = new MouseEvent("click");
                n.dispatchEvent(t)
            })
        }
    }))
});
define("classes/LanguageSelector", [], function() {
    return $.klass({
        initialize: function() {
            var e = ustream.vars.locale,
                o = ustream.vars.locale ? e : "en_US",
                a = !1,
                l = window.location.href;
            /lang=([a-z]{2}_[A-Z]{2})/.test(l) && (a = !0), $.cookie("locale") ? $.cookie("locale") && e !== $.cookie("locale") && a && $.cookie("locale", e, {
                expires: 365,
                path: "/"
            }) : $.cookie("locale", o, {
                expires: 365,
                path: "/"
            }), $("#ChooseLangSelect").length && $("#ChooseLangSelect").change($.proxy(this.langChooser, this, a))
        },
        langChooser: function(e, o) {
            var a, l = $(o.currentTarget).val(),
                t = "Channel_Details" === ustream.vars.pageId,
                n = !!navigator.userAgent.match(/Firefox\/3\./);
            a = window.History && window.History.getState ? window.History.getState().cleanUrl : location.protocol + "//" + location.host + location.pathname, "0" !== l && l !== $.cookie("locale") && ($.cookie("locale", l, {
                expires: 365,
                path: "/"
            }), e && (a = a.replace(/(&?)(\?)?lang=[a-z]{2}_[A-Z]{2}/, "").replace(/\/\?$/, "/")), t && n && (a = a.replace(/[?&].*/, ""), a += "?r=" + String(Math.random()).replace(/.{5}/, "")), window.location.href === a ? location.reload(!0) : window.location.href = a)
        }
    })
});
define("classes/KeepAlive", ["datasources/AjaxDataSource", "lodash"], function(t, e) {
    return {
        running: !1,
        intervalId: void 0,
        frequency: void 0,
        startedAt: void 0,
        url: void 0,
        worker: void 0,
        workerSupported: "Worker" in window,
        createWorker: function() {
            return new Worker(URL.createObjectURL(new Blob(["(", function() {
                self.onmessage = function(t) {
                    "start" === t.data.action && (self.intervalID = setInterval(function() {
                        self.postMessage({
                            action: "execute"
                        })
                    }, t.data.frequency)), "stop" === t.data.action && clearInterval(self.intervalID)
                }
            }.toString(), ")();"], {
                type: "application/javascript"
            })))
        },
        start: function() {
            if (!this.running) {
                if (this.running = !0, this.workerSupported) try {
                    this.worker = this.worker || this.createWorker(), this.worker.postMessage({
                        action: "start",
                        frequency: this.frequency
                    }), this.worker.onmessage = e.bind(this.execute, this)
                } catch (t) {
                    this.worker = void 0, this.workerSupported = !1
                }
                this.worker || (this.intervalId = setInterval(e.bind(this.execute, this), this.frequency))
            }
        },
        stop: function() {
            this.running && (this.running = !1, this.workerSupported ? this.worker.postMessage({
                action: "stop"
            }) : clearInterval(this.intervalId), this.intervalId = null)
        },
        shouldRun: function() {
            var t = new Date;
            return !this.ttl || t - this.startedAt <= this.ttl
        },
        execute: function() {
            this.shouldRun() ? t.getInstance().request({
                url: this.url
            }) : this.stop()
        },
        keepAlive: function(t, e, r) {
            var i = e || 900;
            this.frequency = 1e3 * i - 6e4, this.ttl = r ? 1e3 * r : void 0, this.url = t, this.startedAt = new Date, this.start()
        }
    }
});
ustream.classes.Dialog = $.klass({
    initialize: function() {
        $.capture("OVERLAYOPENED", $.proxy(this.onOverlayOpen, this)), $.capture("OVERLAYCLOSED", $.proxy(this.onOverlayClose, this)), $.capture("FLASHVIEWERREADY", $.proxy(this.onFlashReady, this)), $.capture("VIEWERREADY", $.proxy(this.onFlashReady, this))
    },
    isOpened: !1,
    closeTimeout: null,
    flashIsReady: !1,
    onFlashReady: function() {
        this.flashIsReady = !0, $(".ui-dialog:visible").length && this.onOverlayOpen()
    },
    onOverlayOpen: function() {
        this.flashIsReady && (this.closeTimeout && window.clearTimeout(this.closeTimeout), this.isOpened || (this.isOpened = !0, $.dispatch("OVERLAYOPENEDFLASHCALL")))
    },
    onOverlayClose: function() {
        this.flashIsReady && (this.closeTimeout && window.clearTimeout(this.closeTimeout), this.closeTimeout = setTimeout($.proxy(this.onCloseTimeoutEnd, this), 2e3))
    },
    onCloseTimeoutEnd: function() {
        this.isOpened = !1, this.closeTimeout = null, $.dispatch("OVERLAYCLOSEDFLASHCALL")
    }
});
define("classes/QnaTest", ["jsdebug", "exposedVars"], function(n, e) {
    var a = e.get("qnatest") && !!+e.get("qnatest").enabled || !1,
        s = e.get("qnatest") && +e.get("qnatest").percent || 0,
        t = -1 < window.location.search.indexOf("qnatest");
    return (a = a && !(-1 < document.getElementsByTagName("html")[0].className.indexOf("ie8"))) ? t && (s = 100) : s = (a = t) ? 100 : 0, {
        init: function() {
            var e, t;
            a ? (e = Math.floor(1e5 * Math.random() + 1) / 1e5 * 100, n("QNATEST - " + e + " vs " + s), e < s ? (n("QNATEST - running"), document.getElementsByTagName("body")[0].appendChild(((t = document.createElement("iframe")).width = 0, t.height = 0, t.id = "QNATest", t.src = "https://ustvstaticcdn1-a.akamaihd.net/qnatest/20151119.html", -1 < window.location.search.indexOf("jsdebug") && (t.src += "?jsdebug=1"), t.style = "position: absolute; visibility: hidden;", t))) : n("QNATEST - skip")) : n("QNATEST - not enabled")
        }
    }
});
define("classes/CommonPageBase", ["klass", "classes/CampaignTracking/Controller", "classes/UserNotification", "classes/Facebook", "classes/KeepAlive", "datasources/CookieDataSource", "classes/FacebookLoginStatus", "events", "jsdebug", "exposedVars"], function(e, t, i, a, o, s, n, c, l, r) {
    return e({
        hasNativePlaceholder: !1,
        initialize: function() {
            require(["classes/Authentication/Factory"], function(e) {
                e.createAuthentication()
            }), this.checkOutdatedBrowser(), new ustream.classes.Dialog, this.cookieDataSource = s.getInstance(), r.get("facebookInitDone") ? this.initFacebookLogic() : window.fbAsyncInit = $.proxy(this.initFacebookLogic, this), new a, new ustream.classes.ValidatorInit, new i, this.hasNativePlaceholder = !!("placeholder" in document.createElement("input")), c.capture("RESETPLACEHOLDERS", $.proxy(this.setPlaceholders, this)), this.setPlaceholders(), t && new t, this.callPageSpecificFunction(), r.get("keepAliveEnabled") && o.keepAlive(r.get("keepAliveUrl"), r.get("sessionTimeOut"), r.get("keepAliveTimeout"))
        },
        initFacebookLogic: function() {
            window.FB && r.get("facebookAppId") ? (window.FB.init({
                appId: r.get("facebookAppId"),
                status: !0,
                cookie: !0,
                xfbml: !0,
                oauth: !0,
                version: "v2.0"
            }), new n) : l("Facebook JS SDK Init failed! Please include the widget and set the facebookAppId.")
        },
        callPageSpecificFunction: function() {
            var e = "p" + r.get("pageId").replace(/_/g, "");
            "function" == typeof this[e] && this[e]()
        },
        setPlaceholders: function() {
            this.hasNativePlaceholder || $("label").removeClass("hideTxt")
        },
        checkOutdatedBrowser: function() {
            var e = $("html");
            e.hasClass("permanent") || !e.hasClass("outdated") || this.cookieDataSource.get("outdated_closed") || e.addClass("permanent")
        },
        setMinHeight: function(e) {
            var t = $("#Footer"),
                i = $("#Header").length ? $("#Header").outerHeight() : $(".site-header").outerHeight(),
                a = t.outerHeight(),
                o = e.height(),
                s = window.innerHeight - i - a - 40;
            o < s && e.css({
                minHeight: s
            })
        }
    })
});
define("classes/CommonPage", ["classes/CommonPageBase", "classes/Header/HeaderController", "classes/Header/NewHeaderController", "classes/Footer", "classes/LanguageSelector", "classes/TimeZoneCorrector", "classes/Rsvp", "classes/Follow", "classes/PaymentNotification", "events"], function(e, n, s, t, a, o, i, r, c, l) {
    return e.extend({
        initialize: function() {
            this.parent(), $("#Header").length ? new n : $(".site-header").length && new s, $(".js-site-nav").length && require(["classes/Header/HeaderNavigationController"], function(e) {
                return new e
            }), new o, new i, new r, new a, this.paymentNoficitaion(), this.handlePostMessages()
        },
        handlePostMessages: function() {
            $(window).on("message", $.proxy(function(e) {
                var n = e.originalEvent.data;
                if ("string" == typeof n) try {
                    n = JSON.parse(n)
                } catch (e) {}
                n && "dispatch_global_event" === n.id && l.dispatch(n.event, n.eventData)
            }))
        },
        paymentNoficitaion: function() {
            var e = new c;
            l.capture("ALLTOSACCEPTED", function() {
                setTimeout(function() {
                    e.setNotifications(), e.showNextNotification()
                }, 10)
            })
        }
    })
});